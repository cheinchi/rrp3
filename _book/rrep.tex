% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
  oneside]{book}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{ctex}

%\usepackage{xltxtra} % XeLaTeX的一些额外符号
% 设置中文字体
%\setCJKmainfont[BoldFont={黑体},ItalicFont={楷体}]{新宋体}

% 设置边距
\usepackage{geometry}
\geometry{%
  left=2.0cm, right=2.0cm, top=3.5cm, bottom=2.5cm} 

\usepackage{amsthm,mathrsfs}
\usepackage{booktabs}
\usepackage{longtable}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage[style=apa,]{biblatex}
\addbibresource{book.bib}
\addbibresource{packages.bib}
\addbibresource{article.bib}
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={基于R的文献复刻：利用中国微观数据库},
  pdfauthor={黄建祺},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{基于R的文献复刻：利用中国微观数据库}
\author{黄建祺}
\date{2023-03-17}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{ux524dux8a00}{%
\chapter*{前言}\label{ux524dux8a00}}
\addcontentsline{toc}{chapter}{前言}

\hypertarget{ux7f18ux8d77}{%
\section{缘起}\label{ux7f18ux8d77}}

突然想要研究某一个中国的微观数据库，但又无奈苯人掌握Stata技法有限，想要再去学有点学不动了。忽然一次在网上看到林敏杰老师的\href{https://bookdown.org/wangminjie/R4cfps/}{《CFPS 之R语言学习笔记》} 瞬间为我打开了一扇窗，所以尝试使用R来实现一些在实证经济学的一些应用或称为复刻，另外加上一丁点的探索。之前也看到国外的在利用\textbf{shiny}搭建的网站\footnote{\url{https://ejd.econ.mathematik.uni-ulm.de/}}做的文献复刻，因此就有一些用\texttt{R}来做的冲动。

\hypertarget{ux4e3aux4f55ux662fr}{%
\section{为何是R}\label{ux4e3aux4f55ux662fr}}

为何选择使用R呢。现在在复刻文献的主流方法是使用Stata，同时在一些wiki 或者期刊网站、数据网站\footnote{这篇知乎总结了所有可以发现代码的地方} 上大部分是使用stata来实现复刻或者源代码的。但目前，一些经济学、政治学学者开始在利用R做基本的计量分析，甚至开发专门的R包来实现一些高级计量方法，在R中有很多超越于Stata的优势。

\hypertarget{ux5982ux4f55ux98dfux7528}{%
\section{如何食用}\label{ux5982ux4f55ux98dfux7528}}

这本书是基于中国的几大微观数据库及相关的顶刊上的文章为主要内容写成的自我技术修炼笔记，为最大化他的社会效益，以\textbf{bookdown}形式生成。希望能够对你有所帮助。

在经济学研究中，近些年来对于微观数据的使用变得尤为重要，尤其是大型的微观数据库的使用。但常用的处理方法往往是选择在Stata中进行操作。但在另一方面，R相对于Stata的使用有其独特的优势，尤其是在使用多个数据框操作时候，在今天的一篇文章中很难就单单一个数据源就能完成一篇好的文章写作，因此对于不同数据源进行交互性操作愈发重要。因此有必要使用R来对数据进行相应的操作。同时R也是支持于\texttt{.dta}数据的读取。

同时再深了讲在不同语言之间的比较，\textcite{ARUOBA2015265} 有对比不同的编程语言的运行速度，同时需要强调的是C++/Fortran/Java对比其他的语言是更难学习的，由其本身的特性所决定的，所以对于经济学家来说没有那么多的时间成本学习前三种语言，但可以作为一个参照。最后发现Julia的表现尤其突出，甚至超过于Java，远甩身后的Matlab好几米；Python与R基本上持平，但一用上Pypy编译器立马加速；最慢的是Mathemetica（虽然我也没用过）
\footnote{文章的代码可以\href{https://github.com/jesusfv/Comparison-Programming-Languages-Economics}{在github仓库中找到}}

\begin{figure}

{\centering \includegraphics[width=18.86in]{image/com-jedc} 

}

\caption{图来自上述文章}\label{fig:com-jedc}
\end{figure}

Julia的强劲表现让很多经济学者极力推崇\footnote{以诺奖得主、宏观学者Sargent为代表} 相关的学习材料在\href{https://quantecon.org/}{Quantecon} 就很丰富了。

但我们这里并不需要大量的数据，因此对于编译速度的要求并不高，RStudio能够满足日常的基本需要。

\hypertarget{rux5165ux95e8}{%
\section{R入门}\label{rux5165ux95e8}}

关于R的入门这里不多介绍，\href{www.bookdown.org}{bookdown}中有大量关于R的入门书籍。这里可以做出一定的推荐：

英文比较好的话：

\begin{itemize}
\item
  \href{file:///Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/doc/manual/R-intro.html}{官方manual}
\item
  \href{https://r4ds.had.co.nz/}{R for Data Science}
\item
  \href{https://moderndive.com/}{modern dive}
\item
  \href{https://www.bigbookofr.com/}{Big book of R}：和字典一样厚，作者至今还在更新。
\end{itemize}

看中文更有优势的话：

\begin{itemize}
\item
  \href{https://www.math.pku.edu.cn/teachers/lidf/docs/Rbook/html/_Rbook/index.html}{R语言教程}
\item
  \href{https://bookdown.org/wangminjie/R4DS/}{数据科学中的R语言}
\end{itemize}

当然因为这里主要介绍一些经济学论文和经济学方法，不可避免要学习和使用计量及R上的应用。同样有很多出色的线上教材。

\begin{itemize}
\tightlist
\item
  \href{https://www.econometrics-with-r.org/}{Introduction to Econometric with R}
\item
  \href{https://mixtape.scunning.com/}{Causal Inference: The Mixtape}: 有三种语言的代码任你选择。
\end{itemize}

需要注意的是在R中进行数据处理，必然无法避开学习和使用\textbf{tidyverse}，因为这才是数据科学学习R的优势之处。

这篇所需要使用的R包：使用\texttt{pacman}免去验证是否安装的烦恼。

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{require}\NormalTok{(}\StringTok{"pacman"}\NormalTok{)) }\FunctionTok{install.packages}\NormalTok{(}\StringTok{"pacman"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: pacman
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{p\_load}\NormalTok{(tidyverse,}
\NormalTok{       purrr,}
\NormalTok{       haven,}
\NormalTok{       visdat,}
\NormalTok{       sf,}
\NormalTok{       units,}
\NormalTok{       lwgeom,}
\NormalTok{       rmapshaper,}
\NormalTok{       tictoc)}
\end{Highlighting}
\end{Shaded}

\hypertarget{ux571fux5730ux6d41ux8f6cux7814ux7a76}{%
\chapter{土地流转研究}\label{ux571fux5730ux6d41ux8f6cux7814ux7a76}}

数据来源：\href{http://www.isss.pku.edu.cn/cfps/index.htm}{CFPS}

本章主要参考四川师范大学王敏杰老师的\href{https://bookdown.org/wangminjie/R4cfps/land.html}{研究笔记}

\hypertarget{ux8f7dux5165ux5305}{%
\section{载入包}\label{ux8f7dux5165ux5305}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(purrr)}
\FunctionTok{library}\NormalTok{(haven)}
\FunctionTok{library}\NormalTok{(visdat)}
\end{Highlighting}
\end{Shaded}

\hypertarget{ux5bfcux5165ux6570ux636e}{%
\section{导入数据}\label{ux5bfcux5165ux6570ux636e}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cfps2010family }\OtherTok{\textless{}{-}} \FunctionTok{read\_dta}\NormalTok{(}\StringTok{"data/cfps/2010/cfps2010famecon\_202008.dta"}\NormalTok{)}
\NormalTok{cfps2010family }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(fid,urban, }\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"fk201\_a"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{glimpse}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 14,797
## Columns: 8
## $ fid       <dbl+lbl> 110001, 110003, 110005, 110006, 110007, 110009, 110010, ~
## $ urban     <dbl+lbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,~
## $ fk201_a_1 <dbl+lbl> -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, ~
## $ fk201_a_2 <dbl+lbl> -8.0, -8.0, -8.0, -8.0,  2.5, -8.0, -8.0, -8.0, -8.0, -8~
## $ fk201_a_3 <dbl+lbl> -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, ~
## $ fk201_a_4 <dbl+lbl> -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, ~
## $ fk201_a_5 <dbl+lbl> -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, ~
## $ fk201_a_6 <dbl+lbl> -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, -8, ~
\end{verbatim}

\hypertarget{ux67e5ux770bux53d8ux91cfux6807ux7b7e}{%
\section{查看变量标签}\label{ux67e5ux770bux53d8ux91cfux6807ux7b7e}}

对于原有数据，都是存在一个标签来显示原始的问题形式，因此我们可以先查看我们想要找的问题的标签是否对应。先创建一个\texttt{get\_var\_label}的函数。

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(purrr)}
\NormalTok{get\_var\_label }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(dta) \{}
\NormalTok{  labels }\OtherTok{\textless{}{-}} \FunctionTok{map}\NormalTok{(dta, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{attr}\NormalTok{(x, }\StringTok{"label"}\NormalTok{))}
  \FunctionTok{data\_frame}\NormalTok{(}
    \AttributeTok{name =} \FunctionTok{names}\NormalTok{(labels),}
    \AttributeTok{label =} \FunctionTok{as.character}\NormalTok{(labels)}
\NormalTok{  )}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

根据观察原有标签，我们可知道\texttt{fk201\_a\_n}的变量都是拥有的农业资产，\texttt{fk202\_a\_n}、\texttt{fk203\_a\_n}和\texttt{fk204\_a\_n}分别是经营、转租入和转租出多少农业资产。

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cfps2010family }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(urban, }\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"fk201\_a"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{get\_var\_label}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: `data_frame()` was deprecated in tibble 1.1.0.
## i Please use `tibble()` instead.
\end{verbatim}

\begin{verbatim}
## # A tibble: 7 x 2
##   name      label                           
##   <chr>     <chr>                           
## 1 urban     基于国家统计局资料的城乡分类变量
## 2 fk201_a_1 您家拥有多少亩水田              
## 3 fk201_a_2 您家拥有多少亩旱地              
## 4 fk201_a_3 您家拥有多少亩林地              
## 5 fk201_a_4 您家拥有多少亩果园              
## 6 fk201_a_5 您家拥有多少亩草场              
## 7 fk201_a_6 您家拥有多少亩池塘
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cfps2010family }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(urban, }\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"fk201\_a"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{map}\NormalTok{(}\SpecialCharTok{\textasciitilde{}} \FunctionTok{count}\NormalTok{(}\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{x =}\NormalTok{ .x), x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $urban
##   x    n
## 1 0 7694
## 2 1 7103
## 
## $fk201_a_1
##         x     n
## 1    -8.0 11656
## 2    -1.0     3
## 3     0.0    20
## 4     0.1     6
## 5     0.2    14
## 6     0.3    36
## 7     0.4    36
## 8     0.5    74
## 9     0.6    54
## 10    0.7    49
## 11    0.8    52
## 12    0.9    14
## 13    1.0   346
## 14    1.1    18
## 15    1.2    61
## 16    1.3    27
## 17    1.4    27
## 18    1.5   144
## 19    1.6    28
## 20    1.7    24
## 21    1.8    45
## 22    1.9    14
## 23    2.0   462
## 24    2.1    15
## 25    2.2    17
## 26    2.3    20
## 27    2.4    32
## 28    2.5    94
## 29    2.6    15
## 30    2.7    23
## 31    2.8    25
## 32    2.9     5
## 33    3.0   326
## 34    3.1     3
## 35    3.2    17
## 36    3.3     9
## 37    3.4    10
## 38    3.5    48
## 39    3.6    17
## 40    3.7     5
## 41    3.8    11
## 42    3.9     2
## 43    4.0   228
## 44    4.1     4
## 45    4.2    10
## 46    4.3     6
## 47    4.4     9
## 48    4.5    22
## 49    4.6     2
## 50    4.7     3
## 51    4.8     4
## 52    4.9     1
## 53    5.0   143
## 54    5.2     3
## 55    5.3     1
## 56    5.4     6
## 57    5.5    14
## 58    5.6     1
## 59    5.7     4
## 60    5.8     1
## 61    6.0    96
## 62    6.1     1
## 63    6.3     1
## 64    6.5     9
## 65    6.6     4
## 66    7.0    53
## 67    7.2     2
## 68    7.3     1
## 69    7.4     1
## 70    7.5     4
## 71    7.6     1
## 72    7.8     2
## 73    7.9     1
## 74    8.0    69
## 75    8.1     2
## 76    8.3     1
## 77    8.4     2
## 78    8.5     2
## 79    8.8     1
## 80    9.0    19
## 81   10.0    48
## 82   10.2     1
## 83   10.5     1
## 84   10.8     3
## 85   11.0    15
## 86   11.5     1
## 87   11.6     1
## 88   11.7     1
## 89   12.0    19
## 90   12.6     2
## 91   13.0     7
## 92   13.2     1
## 93   13.5     1
## 94   14.0     4
## 95   14.5     1
## 96   15.0    14
## 97   15.4     1
## 98   16.0     6
## 99   16.4     1
## 100  17.0     1
## 101  18.0     2
## 102  19.0     2
## 103  20.0     5
## 104  21.0     2
## 105  22.0     1
## 106  24.0     4
## 107  25.0     3
## 108  26.0     2
## 109  30.0     2
## 110  37.0     1
## 111  40.0     2
## 112  60.0     2
## 113  63.0     1
## 114 122.0     1
## 
## $fk201_a_2
##         x    n
## 1    -8.0 8552
## 2    -1.0   12
## 3     0.0   42
## 4     0.1   31
## 5     0.2   67
## 6     0.3   74
## 7     0.4   39
## 8     0.5  178
## 9     0.6   64
## 10    0.7   50
## 11    0.8   47
## 12    0.9   11
## 13    1.0  503
## 14    1.1   10
## 15    1.2   45
## 16    1.3   19
## 17    1.4   26
## 18    1.5  132
## 19    1.6   27
## 20    1.7   16
## 21    1.8   33
## 22    1.9    4
## 23    2.0  542
## 24    2.1   12
## 25    2.2   18
## 26    2.3   11
## 27    2.4   17
## 28    2.5   96
## 29    2.6    7
## 30    2.7   13
## 31    2.8   23
## 32    2.9    3
## 33    3.0  479
## 34    3.1    2
## 35    3.2   22
## 36    3.3   13
## 37    3.4   17
## 38    3.5   44
## 39    3.6   27
## 40    3.7   10
## 41    3.8   12
## 42    3.9    7
## 43    4.0  384
## 44    4.1    5
## 45    4.2   17
## 46    4.3    3
## 47    4.4    9
## 48    4.5   70
## 49    4.6    4
## 50    4.7    8
## 51    4.8   16
## 52    4.9    3
## 53    5.0  357
## 54    5.1    1
## 55    5.2    8
## 56    5.3    5
## 57    5.4   12
## 58    5.5   20
## 59    5.6   14
## 60    5.7    5
## 61    5.8    4
## 62    5.9    2
## 63    6.0  337
## 64    6.1    2
## 65    6.2    5
## 66    6.3    5
## 67    6.4   11
## 68    6.5   17
## 69    6.6    4
## 70    6.7    4
## 71    6.8    9
## 72    6.9    3
## 73    7.0  220
## 74    7.2   11
## 75    7.3    1
## 76    7.4    5
## 77    7.5   23
## 78    7.6    5
## 79    7.7    5
## 80    7.8   15
## 81    8.0  220
## 82    8.1    5
## 83    8.2    5
## 84    8.4    7
## 85    8.5   13
## 86    8.6    1
## 87    8.7    3
## 88    8.8    8
## 89    9.0  128
## 90    9.2    4
## 91    9.3    1
## 92    9.4    3
## 93    9.5   10
## 94    9.6   10
## 95    9.7    2
## 96    9.8    3
## 97    9.9    1
## 98   10.0  291
## 99   10.4    1
## 100  10.5    6
## 101  10.6    1
## 102  10.7    1
## 103  10.8    6
## 104  11.0   73
## 105  11.2    1
## 106  11.3    1
## 107  11.5   11
## 108  11.6    1
## 109  11.7    2
## 110  11.8    4
## 111  11.9    1
## 112  12.0  162
## 113  12.4    1
## 114  12.5    7
## 115  12.6    1
## 116  12.7    1
## 117  12.8    2
## 118  13.0   67
## 119  13.2    2
## 120  13.5    2
## 121  13.7    1
## 122  13.8    3
## 123  14.0   65
## 124  14.1    1
## 125  14.5    2
## 126  14.7    1
## 127  14.8    1
## 128  14.9    1
## 129  15.0  116
## 130  15.2    1
## 131  15.3    1
## 132  15.4    1
## 133  15.5    1
## 134  15.6    3
## 135  15.7    1
## 136  16.0   57
## 137  16.8    1
## 138  16.9    2
## 139  17.0   32
## 140  17.2    1
## 141  17.4    2
## 142  17.5    3
## 143  17.6    1
## 144  17.9    1
## 145  18.0   46
## 146  18.1    1
## 147  18.5    2
## 148  18.6    1
## 149  18.7    1
## 150  19.0   12
## 151  19.2    1
## 152  19.5    1
## 153  20.0  123
## 154  20.2    1
## 155  20.8    1
## 156  21.0   20
## 157  21.5    2
## 158  22.0   25
## 159  22.4    1
## 160  22.5    1
## 161  23.0   17
## 162  24.0   22
## 163  25.0   25
## 164  25.7    1
## 165  26.0    7
## 166  26.9    1
## 167  27.0    7
## 168  27.5    1
## 169  28.0    9
## 170  29.0    5
## 171  29.9    1
## 172  30.0   45
## 173  31.6    1
## 174  32.0    4
## 175  33.0    3
## 176  33.2    1
## 177  33.5    1
## 178  34.0    1
## 179  34.1    1
## 180  34.4    1
## 181  34.5    1
## 182  35.0    6
## 183  35.9    1
## 184  36.0    4
## 185  40.0   14
## 186  45.0    2
## 187  47.0    2
## 188  50.0    5
## 189  52.0    1
## 190  55.0    1
## 191  56.0    1
## 192  60.0    4
## 193  70.0    1
## 194  90.0    1
## 195 100.0    3
## 196 160.0    1
## 197 200.0    1
## 198 225.0    1
## 
## $fk201_a_3
##          x     n
## 1     -8.0 13699
## 2     -1.0     5
## 3      0.0    13
## 4      0.1    10
## 5      0.2    10
## 6      0.3    17
## 7      0.4     6
## 8      0.5    30
## 9      0.6     6
## 10     0.7     6
## 11     0.8    12
## 12     0.9     1
## 13     1.0   143
## 14     1.1     2
## 15     1.2     3
## 16     1.3     2
## 17     1.4     4
## 18     1.5    23
## 19     1.6     4
## 20     1.7     1
## 21     1.8     3
## 22     2.0   103
## 23     2.1     1
## 24     2.3     1
## 25     2.4     4
## 26     2.5     7
## 27     2.6     1
## 28     2.7     2
## 29     2.8     2
## 30     3.0   119
## 31     3.1     1
## 32     3.2     1
## 33     3.4     1
## 34     3.5     1
## 35     3.6     1
## 36     3.7     1
## 37     3.8     2
## 38     3.9     1
## 39     4.0    54
## 40     4.3     1
## 41     4.4     1
## 42     4.5     3
## 43     4.8     2
## 44     5.0    61
## 45     5.2     1
## 46     5.3     1
## 47     6.0    33
## 48     6.4     2
## 49     7.0    25
## 50     7.2     1
## 51     7.5     6
## 52     7.8     1
## 53     8.0    28
## 54     8.1     1
## 55     8.3     1
## 56     8.5     1
## 57     9.0     8
## 58     9.6     1
## 59    10.0    61
## 60    10.3     1
## 61    11.0     4
## 62    11.2     1
## 63    11.5     2
## 64    11.7     1
## 65    12.0    13
## 66    13.0     5
## 67    13.5     1
## 68    14.0     6
## 69    14.7     1
## 70    15.0    24
## 71    16.0     4
## 72    16.5     1
## 73    16.8     1
## 74    17.0     1
## 75    17.5     1
## 76    18.0     1
## 77    19.0     3
## 78    20.0    40
## 79    21.0     3
## 80    22.0     4
## 81    22.9     1
## 82    23.0     2
## 83    24.0     4
## 84    25.0     4
## 85    26.0     1
## 86    27.0     2
## 87    27.4     1
## 88    29.0     1
## 89    30.0    31
## 90    34.0     1
## 91    35.0     5
## 92    36.0     1
## 93    40.0    10
## 94    41.0     1
## 95    44.0     1
## 96    45.0     2
## 97    49.7     1
## 98    50.0    18
## 99    53.0     1
## 100   56.0     1
## 101   60.0    10
## 102   68.0     1
## 103   70.0     6
## 104   75.0     1
## 105   80.0     8
## 106   90.0     2
## 107  100.0     7
## 108  102.0     1
## 109  120.0     1
## 110  150.0     2
## 111  160.0     1
## 112  200.0     3
## 113  300.0     1
## 114  370.0     1
## 115 1000.0     3
## 
## $fk201_a_4
##        x     n
## 1   -8.0 14151
## 2   -1.0     6
## 3    0.0    19
## 4    0.1     6
## 5    0.2     9
## 6    0.3    10
## 7    0.4     4
## 8    0.5    33
## 9    0.6     2
## 10   0.7     4
## 11   0.8     6
## 12   0.9     2
## 13   1.0   108
## 14   1.1     1
## 15   1.2     4
## 16   1.4     1
## 17   1.5    23
## 18   1.6     4
## 19   1.7     3
## 20   1.8     3
## 21   2.0   102
## 22   2.3     1
## 23   2.4     1
## 24   2.5     9
## 25   2.7     4
## 26   2.8     2
## 27   3.0    76
## 28   3.2     1
## 29   3.5     6
## 30   3.6     1
## 31   3.7     4
## 32   3.8     1
## 33   3.9     1
## 34   4.0    53
## 35   4.2     1
## 36   4.5     6
## 37   4.8     1
## 38   5.0    27
## 39   5.1     1
## 40   5.3     1
## 41   5.5     2
## 42   6.0    26
## 43   7.0    10
## 44   7.4     1
## 45   8.0    10
## 46  10.0    24
## 47  12.0     4
## 48  15.0     3
## 49  20.0     7
## 50  21.0     1
## 51  25.0     1
## 52  30.0     1
## 53  32.0     1
## 54  35.0     1
## 55  40.0     2
## 56  50.0     2
## 57  80.0     1
## 58 100.0     1
## 59 400.0     1
## 
## $fk201_a_5
##      x     n
## 1 -8.0 14789
## 2  1.0     4
## 3  2.0     2
## 4  3.0     1
## 5  3.3     1
## 
## $fk201_a_6
##       x     n
## 1  -8.0 14706
## 2   0.0    10
## 3   0.1     1
## 4   0.2     3
## 5   0.3     3
## 6   0.4     1
## 7   0.5     7
## 8   0.6     1
## 9   0.7     1
## 10  0.8     2
## 11  1.0     9
## 12  1.5     2
## 13  1.6     1
## 14  2.0     7
## 15  2.5     1
## 16  3.0     5
## 17  4.0     2
## 18  4.7     1
## 19  5.0     4
## 20  6.0     5
## 21  6.3     1
## 22  7.0     1
## 23  8.4     1
## 24 13.0     2
## 25 14.0     1
## 26 16.0     1
## 27 20.0     4
## 28 22.0     2
## 29 23.0     2
## 30 24.0     1
## 31 25.0     3
## 32 30.0     1
## 33 33.0     1
## 34 38.0     1
## 35 50.0     2
## 36 63.0     1
\end{verbatim}

这里使用了\texttt{map}函数来构建一个映射，映射到一个累加求和，第一张表是农业户口和城镇户口的数量对比，后面的表都是密度分布。

\hypertarget{ux6570ux636eux89c4ux6574}{%
\section{数据规整}\label{ux6570ux636eux89c4ux6574}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(naniar)}
\NormalTok{cfps2010family }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(urban, }\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"fk201\_a"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{miss\_var\_summary}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 7 x 3
##   variable  n_miss pct_miss
##   <chr>      <int>    <dbl>
## 1 urban          0        0
## 2 fk201_a_1      0        0
## 3 fk201_a_2      0        0
## 4 fk201_a_3      0        0
## 5 fk201_a_4      0        0
## 6 fk201_a_5      0        0
## 7 fk201_a_6      0        0
\end{verbatim}

基本上是没有缺失数据。

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(visdat)}
\NormalTok{cfps2010family }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(urban, }\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"fk201\_a"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{vis\_dat}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{01-land_files/figure-latex/unnamed-chunk-7-1.pdf}

为防止包之间的函数冲突，使用\texttt{conflicted}来prefer到\texttt{dplyr}中的\texttt{filter}。

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(conflicted)}
\FunctionTok{conflict\_prefer}\NormalTok{(}\StringTok{"filter"}\NormalTok{, }\StringTok{"dplyr"}\NormalTok{)}

\NormalTok{cfps2010family }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(urban, }\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"fk2\_s"}\NormalTok{))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(urban }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 7,694 x 6
##    urban     fk2_s_1     fk2_s_2     fk2_s_3     fk2_s_4     fk2_s_5    
##    <dbl+lbl> <dbl+lbl>   <dbl+lbl>   <dbl+lbl>   <dbl+lbl>   <dbl+lbl>  
##  1 0 [乡村]   4 [果园]   -8 [不适用] -8 [不适用] -8 [不适用] -8 [不适用]
##  2 0 [乡村]   2 [旱地]   -8 [不适用] -8 [不适用] -8 [不适用] -8 [不适用]
##  3 0 [乡村]   4 [果园]   -8 [不适用] -8 [不适用] -8 [不适用] -8 [不适用]
##  4 0 [乡村]   4 [果园]   -8 [不适用] -8 [不适用] -8 [不适用] -8 [不适用]
##  5 0 [乡村]  -8 [不适用] -8 [不适用] -8 [不适用] -8 [不适用] -8 [不适用]
##  6 0 [乡村]  -8 [不适用] -8 [不适用] -8 [不适用] -8 [不适用] -8 [不适用]
##  7 0 [乡村]  -8 [不适用] -8 [不适用] -8 [不适用] -8 [不适用] -8 [不适用]
##  8 0 [乡村]   6 [池塘]   -8 [不适用] -8 [不适用] -8 [不适用] -8 [不适用]
##  9 0 [乡村]   4 [果园]   -8 [不适用] -8 [不适用] -8 [不适用] -8 [不适用]
## 10 0 [乡村]  -8 [不适用] -8 [不适用] -8 [不适用] -8 [不适用] -8 [不适用]
## # ... with 7,684 more rows
\end{verbatim}

先找出有经营土地的家户：并不考虑是否是自己拥有还是转租入。

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}}\NormalTok{ cfps2010family }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(fid,urban, }\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"fk201\_a"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter\_at}\NormalTok{(}\FunctionTok{vars}\NormalTok{(}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"fk201\_a"}\NormalTok{)), }\FunctionTok{any\_vars}\NormalTok{(. }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{))}
\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 7,688 x 8
##    fid       urban     fk201_a_1   fk201_a_2 fk201_~1 fk201_~2 fk201_~3 fk201_~4
##    <dbl+lbl> <dbl+lbl> <dbl+lbl>   <dbl+lbl> <dbl+lb> <dbl+lb> <dbl+lb> <dbl+lb>
##  1 110007    1 [城镇]  -8 [不适用]  2.5    ~ -8 [不~ -8 [不~ -8 [不~ -8 [不~
##  2 120033    1 [城镇]  -8 [不适用] -8 [不适~ -8 [不~  0.900 ~ -8 [不~ -8 [不~
##  3 120073    0 [乡村]  -8 [不适用] -8 [不适~ -8 [不~  5.10  ~ -8 [不~ -8 [不~
##  4 120074    0 [乡村]  -8 [不适用]  1.80   ~ -8 [不~ -8 [不~ -8 [不~ -8 [不~
##  5 120076    0 [乡村]  -8 [不适用] -8 [不适~ -8 [不~  6     ~ -8 [不~ -8 [不~
##  6 120080    0 [乡村]  -8 [不适用] -8 [不适~ -8 [不~ -8 [不~ -8 [不~ 38     ~
##  7 120081    0 [乡村]  -8 [不适用] -8 [不适~ -8 [不~  4     ~ -8 [不~ -8 [不~
##  8 120084    0 [乡村]  -8 [不适用] -8 [不适~ -8 [不~  1.5   ~ -8 [不~ -8 [不~
##  9 120087    0 [乡村]  -8 [不适用] -8 [不适~ -8 [不~  3     ~ -8 [不~ -8 [不~
## 10 120088    0 [乡村]  -8 [不适用]  1.5    ~ -8 [不~ -8 [不~ -8 [不~ -8 [不~
## # ... with 7,678 more rows, and abbreviated variable names 1: fk201_a_3,
## #   2: fk201_a_4, 3: fk201_a_5, 4: fk201_a_6
\end{verbatim}

再将负值转变为0。

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate\_at}\NormalTok{(}\FunctionTok{vars}\NormalTok{(}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"fk201\_a"}\NormalTok{)), }\FunctionTok{funs}\NormalTok{(}\FunctionTok{replace}\NormalTok{(., . }\SpecialCharTok{\textless{}} \DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: `funs()` was deprecated in dplyr 0.8.0.
## i Please use a list of either functions or lambdas:
## 
## # Simple named list: list(mean = mean, median = median)
## 
## # Auto named with `tibble::lst()`: tibble::lst(mean, median)
## 
## # Using lambdas list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
\end{verbatim}

\begin{verbatim}
## # A tibble: 7,688 x 8
##    fid       urban     fk201_a_1 fk201_a_2 fk201_a_3 fk201_a_4 fk201_a_5 fk201~1
##    <dbl+lbl> <dbl+lbl> <dbl+lbl> <dbl+lbl> <dbl+lbl> <dbl+lbl> <dbl+lbl> <dbl+l>
##  1 110007    1 [城镇]  0         2.5       0         0         0          0     
##  2 120033    1 [城镇]  0         0         0         0.900     0          0     
##  3 120073    0 [乡村]  0         0         0         5.10      0          0     
##  4 120074    0 [乡村]  0         1.80      0         0         0          0     
##  5 120076    0 [乡村]  0         0         0         6         0          0     
##  6 120080    0 [乡村]  0         0         0         0         0         38     
##  7 120081    0 [乡村]  0         0         0         4         0          0     
##  8 120084    0 [乡村]  0         0         0         1.5       0          0     
##  9 120087    0 [乡村]  0         0         0         3         0          0     
## 10 120088    0 [乡村]  0         1.5       0         0         0          0     
## # ... with 7,678 more rows, and abbreviated variable name 1: fk201_a_6
\end{verbatim}

\hypertarget{ux519cux4e1aux751fux4ea7ux6548ux7387}{%
\subsection{农业生产效率}\label{ux519cux4e1aux751fux4ea7ux6548ux7387}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}}\NormalTok{ cfps2010family }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(fid,urban, }\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"fk201\_a"}\NormalTok{),fk3,fk4,fe1)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{revenue =}\NormalTok{ fk3}\SpecialCharTok{{-}}\NormalTok{fk4)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate\_at}\NormalTok{(}\FunctionTok{vars}\NormalTok{(}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"fk201\_a"}\NormalTok{)), }\FunctionTok{funs}\NormalTok{(}\FunctionTok{replace}\NormalTok{(., . }\SpecialCharTok{\textless{}} \DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{)))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate\_at}\NormalTok{(}\FunctionTok{vars}\NormalTok{(}\StringTok{"revenue"}\NormalTok{), }\FunctionTok{funs}\NormalTok{(}\FunctionTok{replace}\NormalTok{(., . }\SpecialCharTok{\textless{}} \DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{)))}\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(revenue}\SpecialCharTok{\textgreater{}}\DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: `funs()` was deprecated in dplyr 0.8.0.
## i Please use a list of either functions or lambdas:
## 
## # Simple named list: list(mean = mean, median = median)
## 
## # Auto named with `tibble::lst()`: tibble::lst(mean, median)
## 
## # Using lambdas list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
\end{verbatim}

\begin{verbatim}
## Warning: `funs()` was deprecated in dplyr 0.8.0.
## i Please use a list of either functions or lambdas:
## 
## # Simple named list: list(mean = mean, median = median)
## 
## # Auto named with `tibble::lst()`: tibble::lst(mean, median)
## 
## # Using lambdas list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6,093 x 12
##    fid       urban   fk201~1 fk201~2 fk201~3 fk201~4 fk201~5 fk201~6 fk3   fk4  
##    <dbl+lbl> <dbl+l> <dbl+l> <dbl+l> <dbl+l> <dbl+l> <dbl+l> <dbl+l> <dbl> <dbl>
##  1 110007    1 [城~ 0       2.5     0       0       0       0        1800   500
##  2 120033    1 [城~ 0       0       0       0.900   0       0       16000  1500
##  3 120074    0 [乡~ 0       1.80    0       0       0       0        2100   900
##  4 120075    0 [乡~ 0       0       0       0       0       0       15000  5500
##  5 120076    0 [乡~ 0       0       0       6       0       0       30000 12000
##  6 120081    0 [乡~ 0       0       0       4       0       0       32000  6000
##  7 120084    0 [乡~ 0       0       0       1.5     0       0        7000  4000
##  8 120087    0 [乡~ 0       0       0       3       0       0       25000  5000
##  9 120088    0 [乡~ 0       1.5     0       0       0       0        5300   300
## 10 120090    0 [乡~ 0       0       0       4.5     0       0       26000  6000
## # ... with 6,083 more rows, 2 more variables: fe1 <dbl+lbl>, revenue <dbl>, and
## #   abbreviated variable names 1: fk201_a_1, 2: fk201_a_2, 3: fk201_a_3,
## #   4: fk201_a_4, 5: fk201_a_5, 6: fk201_a_6
\end{verbatim}

一个有效的建议是在对原始数据进行操作时候，尽量保证原始数据的不变，再通过\texttt{\%\textgreater{}\%}进行传导到新的数据框中。

我们计算农业生产效率的方法有很多这里主要参考的是一些主流的做法：将单位面积纯利润作为效率的衡量指标

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{landsum =} \FunctionTok{rowSums}\NormalTok{(.[}\DecValTok{2}\SpecialCharTok{:}\DecValTok{7}\NormalTok{]))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(landsum}\SpecialCharTok{\textgreater{}}\DecValTok{0}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{rates =}\NormalTok{ revenue}\SpecialCharTok{/}\NormalTok{landsum)}\OtherTok{{-}\textgreater{}}\NormalTok{a1}
\NormalTok{a1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6,048 x 14
##    fid       urban   fk201~1 fk201~2 fk201~3 fk201~4 fk201~5 fk201~6 fk3   fk4  
##    <dbl+lbl> <dbl+l> <dbl+l> <dbl+l> <dbl+l> <dbl+l> <dbl+l> <dbl+l> <dbl> <dbl>
##  1 110007    1 [城~ 0       2.5     0       0       0       0        1800   500
##  2 120033    1 [城~ 0       0       0       0.900   0       0       16000  1500
##  3 120074    0 [乡~ 0       1.80    0       0       0       0        2100   900
##  4 120076    0 [乡~ 0       0       0       6       0       0       30000 12000
##  5 120081    0 [乡~ 0       0       0       4       0       0       32000  6000
##  6 120084    0 [乡~ 0       0       0       1.5     0       0        7000  4000
##  7 120087    0 [乡~ 0       0       0       3       0       0       25000  5000
##  8 120088    0 [乡~ 0       1.5     0       0       0       0        5300   300
##  9 120090    0 [乡~ 0       0       0       4.5     0       0       26000  6000
## 10 120091    0 [乡~ 0       0       0       4       0       0       30000  5000
## # ... with 6,038 more rows, 4 more variables: fe1 <dbl+lbl>, revenue <dbl>,
## #   landsum <dbl>, rates <dbl>, and abbreviated variable names 1: fk201_a_1,
## #   2: fk201_a_2, 3: fk201_a_3, 4: fk201_a_4, 5: fk201_a_5, 6: fk201_a_6
\end{verbatim}

\hypertarget{ux6d41ux52a8ux4ebaux53e3}{%
\subsection{流动人口}\label{ux6d41ux52a8ux4ebaux53e3}}

我们可以用外出打工在家庭人口中的占比来测算流动率。

\includegraphics{image/fe1.png}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(conflicted)}
\FunctionTok{conflict\_prefer}\NormalTok{(}\StringTok{\textquotesingle{}filter\textquotesingle{}}\NormalTok{,}\StringTok{"dplyr"}\NormalTok{)}
\NormalTok{a1}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(fe1}\SpecialCharTok{!=}\DecValTok{5}\NormalTok{)}\OtherTok{{-}\textgreater{}}\NormalTok{a2}
\NormalTok{a2}\SpecialCharTok{$}\NormalTok{fe1[a2}\SpecialCharTok{$}\NormalTok{fe1}\SpecialCharTok{==}\DecValTok{3}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{0}
\NormalTok{a2}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(rates,fe1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6,017 x 2
##    rates fe1      
##    <dbl> <dbl+lbl>
##  1  371. 0        
##  2 7632. 0        
##  3  667. 0        
##  4 3000  1 [有]   
##  5 6500  0        
##  6 2000  0        
##  7 6667. 0        
##  8 3333. 0        
##  9 4444. 0        
## 10 6250  0        
## # ... with 6,007 more rows
\end{verbatim}

\hypertarget{ux6a21ux578bux5efaux7acb}{%
\section{模型建立}\label{ux6a21ux578bux5efaux7acb}}

我们试图考察关于流动人口与农业生产效率之间的关系：

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{reg }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(}\AttributeTok{data =}\NormalTok{ a2,fe1}\SpecialCharTok{\textasciitilde{}}\NormalTok{rates)}
\FunctionTok{summary}\NormalTok{(reg)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = fe1 ~ rates, data = a2)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -0.3873 -0.3869 -0.3862  0.6130  0.9042 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  3.873e-01  6.329e-03    61.2   <2e-16 ***
## rates       -8.330e-07  6.409e-07    -1.3    0.194    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.4869 on 6015 degrees of freedom
## Multiple R-squared:  0.0002807,  Adjusted R-squared:  0.0001145 
## F-statistic: 1.689 on 1 and 6015 DF,  p-value: 0.1938
\end{verbatim}

不过不显著。。。不过系数上看是一个较为合理的存在（效率上升，抑制外出）。对于一个想要看星星的reg monkey来说极其苦恼。我们可以考虑换一个变量：一篇2016年在《中国农村经济》的文章研究``非农就业、土地流转与农业生产效率变化''利用的是非农就业来考察劳动生产率（同样也是用单位土地的农产品收入来测算）就较为显著，主要的差别在于非农就业数量来测度，并非一个虚拟变量。
还有一个可能是在先前的数据处理中存在一定的问题，比如是否将未从事农业活动的家户过滤进来。

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cfps2010family}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(fid,familysize,}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"fu1\_s"}\NormalTok{))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate\_at}\NormalTok{(}\FunctionTok{vars}\NormalTok{(}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"fu1\_s"}\NormalTok{)), }\FunctionTok{funs}\NormalTok{(}\FunctionTok{replace}\NormalTok{(., . }\SpecialCharTok{\textless{}} \DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{)))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate\_at}\NormalTok{(}\FunctionTok{vars}\NormalTok{(}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"fu1\_s"}\NormalTok{)), }\FunctionTok{funs}\NormalTok{(}\FunctionTok{replace}\NormalTok{(., . }\SpecialCharTok{\textgreater{}=}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)))}\OtherTok{{-}\textgreater{}}\NormalTok{b1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: `funs()` was deprecated in dplyr 0.8.0.
## i Please use a list of either functions or lambdas:
## 
## # Simple named list: list(mean = mean, median = median)
## 
## # Auto named with `tibble::lst()`: tibble::lst(mean, median)
## 
## # Using lambdas list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
\end{verbatim}

\begin{verbatim}
## Warning: `funs()` was deprecated in dplyr 0.8.0.
## i Please use a list of either functions or lambdas:
## 
## # Simple named list: list(mean = mean, median = median)
## 
## # Auto named with `tibble::lst()`: tibble::lst(mean, median)
## 
## # Using lambdas list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
\end{verbatim}

并不建议一次性将所有变换都做完，之后再检查是非常痛苦的。。。

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b1}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{mig =} \FunctionTok{rowSums}\NormalTok{(.[}\DecValTok{3}\SpecialCharTok{:}\DecValTok{14}\NormalTok{]))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(fid,familysize,mig)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{mig\_rate =}\NormalTok{ mig}\SpecialCharTok{/}\NormalTok{familysize)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(mig\_rate}\SpecialCharTok{\textless{}=}\DecValTok{1}\SpecialCharTok{\&}\NormalTok{mig\_rate}\SpecialCharTok{\textgreater{}=}\DecValTok{0}\NormalTok{)}\OtherTok{{-}\textgreater{}}\NormalTok{b2}\CommentTok{\# 剔除异常值}
\FunctionTok{barplot}\NormalTok{(}\FunctionTok{table}\NormalTok{(b2}\SpecialCharTok{$}\NormalTok{mig\_rate))}
\end{Highlighting}
\end{Shaded}

\includegraphics{01-land_files/figure-latex/unnamed-chunk-16-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(b2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 14795     4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b3 }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(a2,b2,}\AttributeTok{by=}\StringTok{"fid"}\NormalTok{)}
\NormalTok{reg2 }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(}\AttributeTok{data =}\NormalTok{ b3,mig\_rate}\SpecialCharTok{\textasciitilde{}}\NormalTok{rates)}
\FunctionTok{summary}\NormalTok{(reg2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = mig_rate ~ rates, data = b3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -0.1249 -0.1248 -0.1247  0.1251  0.8760 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  1.249e-01  2.384e-03   52.40   <2e-16 ***
## rates       -2.029e-07  2.415e-07   -0.84    0.401    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.1834 on 6015 degrees of freedom
## Multiple R-squared:  0.0001174,  Adjusted R-squared:  -4.887e-05 
## F-statistic: 0.706 on 1 and 6015 DF,  p-value: 0.4008
\end{verbatim}

p值比之前还更大了。。。上述提到的文章的核心解释变量是非农占家庭劳动力比例，但目前还不知咋构建的。。。想到了再补上去。

\hypertarget{ux6587ux732eux590dux523bux52b3ux52a8ux529bux6d41ux52a8ux5982ux4f55ux5f71ux54cdux519cux6237ux501fux8d37}{%
\chapter{文献复刻：《劳动力流动如何影响农户借贷》}\label{ux6587ux732eux590dux523bux52b3ux52a8ux529bux6d41ux52a8ux5982ux4f55ux5f71ux54cdux519cux6237ux501fux8d37}}

\hypertarget{ux6587ux732eux56deux987e}{%
\section{文献回顾}\label{ux6587ux732eux56deux987e}}

\href{https://www.cnki.com.cn/Article/CJFDTOTAL-SJJJ202112006.htm}{这篇文章}主要发现劳动力流动导致农户借出的概率和金额显著增加。

\begin{itemize}
\item
  核心的被解释变量为家庭是否有借给亲戚、朋友等的借出款项和为家庭人均借出金额的对数值。降低极端值影响，进行上下2\%缩尾处理。
\item
  劳动力流动：是否有劳动力流动以及家庭劳动力流动人数。
\item
  控制变量：
\end{itemize}

\hypertarget{ux6570ux636eux5904ux7406}{%
\section{数据处理}\label{ux6570ux636eux5904ux7406}}

加载cfps2018数据:

\hypertarget{ux7edfux8ba1ux63cfux8ff0}{%
\section{统计描述}\label{ux7edfux8ba1ux63cfux8ff0}}

\hypertarget{ux6a21ux578bux8bbeux5b9a}{%
\section{模型设定}\label{ux6a21ux578bux8bbeux5b9a}}

\hypertarget{culture}{%
\chapter{宗族文化}\label{culture}}

对于宗族文化的研究近些年一直是较为火热的研究热点\autocite{Cao2022},\autocite{Hanetsu2019a},\autocite{ZhangShinYi2021a},\autocite{ChenAkiraKai2018},\autocite{ZhangKawagawa2017},\autocite{ZHANG2020100}和\autocite{FAN2023457}。但对于宗族文化的测度方法又各具差异，比如 \textcite{ZHANG2020100}, \textcite{Cao2022} 和 \textcite{FAN2023457} 都是使用上海古籍出版社的县地方族谱数据来测量宗族文化，\textcite{ZhangKawagawa2017} 使用的是CFPS的数据来测量；\textcite{ZhangShinYi2021a} 使用的是地方的前三姓氏来作为度量，数据来源是2005年的1\%人口抽样调查数据。数据质量上，直观感受是上海古籍出版社的数据会优于其他几个。

\hypertarget{ux6570ux636eux8f7dux5165}{%
\section{数据载入}\label{ux6570ux636eux8f7dux5165}}

如何在R中没有任何资源的前提下进行关于宗族文化的测度，我先试了做法最为简便的，城市的前三姓氏我翻遍了所有变量都没找到姓氏的变量；后面又看了下上海古籍出版社数据，数据量太大，估计需要爬虫等黑科技，遂又放弃，之后只有选择CFPS，之后也并不很顺利。

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(haven)}
\end{Highlighting}
\end{Shaded}

\includegraphics{image/q1.png}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cfps2010comm }\OtherTok{\textless{}{-}} \FunctionTok{read\_dta}\NormalTok{(}\StringTok{"/Users/a182501/rproject/cfps/data/社区数据cfps/cfps2010comm\_201906.dta"}\NormalTok{)}
\NormalTok{cfps2010comm}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(cid,provcd,countyid,cyear,cmonth,ca3\_s\_6,ca3\_s\_7)}\OtherTok{{-}\textgreater{}}\NormalTok{df1}
\FunctionTok{head}\NormalTok{(df1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 7
##   cid       provcd        countyid  cyear     cmonth ca3_s_6            ca3_s_7 
##   <dbl+lbl> <dbl+lbl>     <dbl+lbl> <dbl+lbl>  <dbl> <dbl+lbl>          <dbl+lb>
## 1 13200     12 [天津市]    79       2010          10 -8 [不适用]      ~ -8 [不~
## 2 13190     12 [天津市]    79       2010          10  9 [老年活动场所/~ 13 [村/~
## 3 12780     14 [山西省]    69       2010          10  8 [教堂/清真寺] ~ 10 [敬~
## 4 21340     44 [广东省]   116       2010          10  9 [老年活动场所/~ 13 [村/~
## 5 12260     23 [黑龙江省]  56       2010           9 -8 [不适用]      ~ -8 [不~
## 6 21640     44 [广东省]   123       2010          10  7 [家族祠堂]    ~ 11 [体~
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(df1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 635   7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cfps2010comm}\SpecialCharTok{$}\NormalTok{ca3\_s\_6[}\FunctionTok{which}\NormalTok{(df1}\SpecialCharTok{$}\NormalTok{ca3\_s\_6}\SpecialCharTok{=={-}}\DecValTok{8}\NormalTok{)]}\OtherTok{=}\DecValTok{0}
\NormalTok{cfps2010comm}\SpecialCharTok{$}\NormalTok{ca3\_s\_7[}\FunctionTok{which}\NormalTok{(df1}\SpecialCharTok{$}\NormalTok{ca3\_s\_7}\SpecialCharTok{=={-}}\DecValTok{8}\NormalTok{)]}\OtherTok{=}\DecValTok{0}
\FunctionTok{table}\NormalTok{(cfps2010comm}\SpecialCharTok{$}\NormalTok{ca3\_s\_7)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##   0   2   7   8   9  10  11  12  13  14  15 
## 262   2  14   6  41  26  66  26 106  68  18
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(cfps2010comm}\SpecialCharTok{$}\NormalTok{ca3\_s\_6)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##   0   2   3   5   6   7   8   9  10  11  12  13  14  15 
## 172   1   1   1  47  23  23  92  24  58  21  94  72   6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{na.omit}\NormalTok{(df1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 635 x 7
##    cid       provcd        countyid  cyear     cmonth ca3_s_6           ca3_s_7 
##    <dbl+lbl> <dbl+lbl>     <dbl+lbl> <dbl+lbl>  <dbl> <dbl+lbl>         <dbl+lb>
##  1 13200     12 [天津市]    79       2010          10 -8 [不适用]     ~ -8 [不~
##  2 13190     12 [天津市]    79       2010          10  9 [老年活动场所~ 13 [村/~
##  3 12780     14 [山西省]    69       2010          10  8 [教堂/清真寺]~ 10 [敬~
##  4 21340     44 [广东省]   116       2010          10  9 [老年活动场所~ 13 [村/~
##  5 12260     23 [黑龙江省]  56       2010           9 -8 [不适用]     ~ -8 [不~
##  6 21640     44 [广东省]   123       2010          10  7 [家族祠堂]   ~ 11 [体~
##  7 21730     44 [广东省]   126       2010          10 -8 [不适用]     ~ -8 [不~
##  8 22523     62 [甘肃省]   145       2010           9 -8 [不适用]     ~ -8 [不~
##  9 10930     52 [贵州省]    24       2010          10 12 [儿童游乐场所~ 13 [村/~
## 10 10100     34 [安徽省]     3       2010          10  6 [庙宇/道观]  ~ 10 [敬~
## # ... with 625 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(df1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 635   7
\end{verbatim}

根据社区问卷手册，我们可以指导

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\NormalTok{cfps2010comm}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(provcd)}\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{summarise}\NormalTok{(}\AttributeTok{x1=}\FunctionTok{sum}\NormalTok{(ca3\_s\_6),}\AttributeTok{x2=}\FunctionTok{sum}\NormalTok{(ca3\_s\_7))}\OtherTok{{-}\textgreater{}}\NormalTok{df2}
\NormalTok{df2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 25 x 3
##    provcd           x1    x2
##    <dbl+lbl>     <dbl> <dbl>
##  1 11 [北京市]      27    14
##  2 12 [天津市]       9    13
##  3 13 [河北省]     216   178
##  4 14 [山西省]     207   220
##  5 21 [辽宁省]     525   511
##  6 22 [吉林省]      97   112
##  7 23 [黑龙江省]   159   155
##  8 31 [上海市]     495   386
##  9 32 [江苏省]     127   117
## 10 33 [浙江省]     111   126
## # ... with 15 more rows
\end{verbatim}

\hypertarget{ux53efux89c6ux5316}{%
\section{可视化}\label{ux53efux89c6ux5316}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{ggplot}\NormalTok{(df2)}\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{x1,}\AttributeTok{y=}\NormalTok{x2))}\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{method =} \StringTok{\textquotesingle{}lm\textquotesingle{}}\NormalTok{,}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{x1,}\AttributeTok{y=}\NormalTok{x2))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using formula = 'y ~ x'
\end{verbatim}

\begin{figure}

{\centering \includegraphics{03-clan_files/figure-latex/as-1} 

}

\caption{祠堂与族谱}\label{fig:as}
\end{figure}

\hypertarget{ux5730ux56fe}{%
\section{地图}\label{ux5730ux56fe}}

将论文图表绘制在图上。

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d }\OtherTok{\textless{}{-}} \FunctionTok{attributes}\NormalTok{(df2}\SpecialCharTok{$}\NormalTok{provcd)}\SpecialCharTok{$}\NormalTok{labels}
\NormalTok{d }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(d)}
\NormalTok{d2 }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(d)}
\NormalTok{d3 }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(d,d2)}
\FunctionTok{colnames}\NormalTok{(d3) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"provcd"}\NormalTok{,}\StringTok{"label"}\NormalTok{)}
\NormalTok{d4 }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(df2,d3,}\AttributeTok{by =} \StringTok{"provcd"}\NormalTok{)}
\NormalTok{d4}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    provcd  x1  x2          label
## 1      11  27  14         北京市
## 2      12   9  13         天津市
## 3      13 216 178         河北省
## 4      14 207 220         山西省
## 5      21 525 511         辽宁省
## 6      22  97 112         吉林省
## 7      23 159 155       黑龙江省
## 8      31 495 386         上海市
## 9      32 127 117         江苏省
## 10     33 111 126         浙江省
## 11     34 123 113         安徽省
## 12     35  47  63         福建省
## 13     36 102 107         江西省
## 14     37 220 125         山东省
## 15     41 538 453         河南省
## 16     42  76  90         湖北省
## 17     43 190 147         湖南省
## 18     44 493 566         广东省
## 19     45 107  35 广西壮族自治区
## 20     50  66  59         重庆市
## 21     51 155 149         四川省
## 22     52  88  71         贵州省
## 23     53 147 141         云南省
## 24     61  73  58         陕西省
## 25     62 517 408         甘肃省
\end{verbatim}

json数据来源于\href{http://datav.aliyun.com/portal/school/atlas/area_selector}{阿里 DataV 数据可视化平台}，能够在多个行政层级绘制中国地图。

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(echarts4r.maps)}
\FunctionTok{library}\NormalTok{(echarts4r)}
\FunctionTok{colnames}\NormalTok{(d4) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"provcd"}\NormalTok{,}\StringTok{"value1"}\NormalTok{,}\StringTok{"value2"}\NormalTok{,}\StringTok{"region"}\NormalTok{)}
\NormalTok{china\_map }\OtherTok{\textless{}{-}}\NormalTok{ jsonlite}\SpecialCharTok{::}\FunctionTok{read\_json}\NormalTok{(}\StringTok{"rep.json"}\NormalTok{)}
\NormalTok{d4 }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{e\_charts}\NormalTok{(region)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{e\_map\_register}\NormalTok{(}\StringTok{"China2"}\NormalTok{, china\_map) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{e\_map}\NormalTok{(value1, }\AttributeTok{map =} \StringTok{"China2"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{e\_visual\_map}\NormalTok{(value1)}
\end{Highlighting}
\end{Shaded}

\includegraphics{03-clan_files/figure-latex/unnamed-chunk-6-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{d4 }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{e\_charts}\NormalTok{(region)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{e\_map\_register}\NormalTok{(}\StringTok{"China2"}\NormalTok{, china\_map) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{e\_map}\NormalTok{(value2, }\AttributeTok{map =} \StringTok{"China2"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{e\_visual\_map}\NormalTok{(value2)}
\end{Highlighting}
\end{Shaded}

\includegraphics{03-clan_files/figure-latex/unnamed-chunk-7-1.pdf}

上面的数据还是挺让人吃惊的，一般会认为宗族文化会在南方更为发达，包括修建祠堂上，我们通过图 \ref{fig:as} 中知道祠堂与家谱是基本上在省层面是正相关的，但地域上呈现了较大的差异。可能是与抽样方法有关，需要进一步的处理。

\hypertarget{ux5176ux4ed6ux6570ux636eux6e90}{%
\section{其他数据源}\label{ux5176ux4ed6ux6570ux636eux6e90}}

目前学界用的较为广泛的是通过上海家族族谱来测算宗族文化，也就是看一个地方的族谱的密度来作为宗族文化的代理变量，代表性学者有浙大的\href{https://scholar.google.com/citations?user=_YWE1C4AAAAJ\&hl=en\&oi=ao}{张川川老师}，他目前发表的关于宗族文化的论文有\autocite{Cao2022}, \autocite{ZHANG2020100}, \autocite{ZhangKawagawa2017}。
很巧，他和合作者\href{https://yiqingxu.org/}{Yiqin Xu}和博士生曹家瑞在JDE刊发的论文有\href{https://yiqingxu.org/papers/english/2022_famine/replication.zip}{replicate file}(可直接下载)

但图中的图是使用ArcGIS来实现的，这里试图通过R来进行复刻。

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{clan\_gbook }\OtherTok{\textless{}{-}} \FunctionTok{read\_dta}\NormalTok{(}\StringTok{"/Users/a182501/stata{-}replicat/replication/datafiles/gbooks\_byyear.dta"}\NormalTok{)}
\FunctionTok{head}\NormalTok{(clan\_gbook)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 2
##    year year_imp
##   <dbl>    <dbl>
## 1   970      970
## 2  1430     1430
## 3  1800     1800
## 4  1880     1880
## 5  1890     1890
## 6  1900     1900
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{p }\OtherTok{\textless{}{-}}\NormalTok{ clan\_gbook}\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(year}\SpecialCharTok{\textless{}=}\DecValTok{2010}\SpecialCharTok{\&}\NormalTok{year}\SpecialCharTok{\textgreater{}=}\DecValTok{1400}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
    \FunctionTok{geom\_histogram}\NormalTok{(}\FunctionTok{aes}\NormalTok{(year\_imp),}\AttributeTok{binwidth =} \DecValTok{1}\NormalTok{)}

\NormalTok{p}\SpecialCharTok{+}\FunctionTok{geom\_vline}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{xintercept=}\DecValTok{1950}\NormalTok{), }\AttributeTok{colour=}\StringTok{"\#BB0000"}\NormalTok{,}\AttributeTok{size =} \FloatTok{0.2}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{geom\_vline}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{xintercept=}\DecValTok{1980}\NormalTok{), }\AttributeTok{colour=}\StringTok{"\#BB0000"}\NormalTok{,}\AttributeTok{size =} \FloatTok{0.2}\NormalTok{)}\SpecialCharTok{+}\FunctionTok{xlab}\NormalTok{(}\StringTok{"Year"}\NormalTok{)}\SpecialCharTok{+}\FunctionTok{ylab}\NormalTok{(}\StringTok{"Frequency"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
## i Please use `linewidth` instead.
\end{verbatim}

\includegraphics{03-clan_files/figure-latex/unnamed-chunk-8-1.pdf}

在统计上的大小与原作者给出的频率有一定的差异，不过形状是相同的。

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(mapchina)}
\FunctionTok{library}\NormalTok{(sysfonts)}
\FunctionTok{library}\NormalTok{(showtextdb)}
\FunctionTok{library}\NormalTok{(showtext)}
\FunctionTok{library}\NormalTok{(sf)}
\FunctionTok{library}\NormalTok{(haven)}
\NormalTok{clan\_disr }\OtherTok{\textless{}{-}} \FunctionTok{read\_dta}\NormalTok{(}\StringTok{"/Users/a182501/stata{-}replicat/replication/datafiles/clan\_distr.dta"}\NormalTok{)}
\FunctionTok{arrange}\NormalTok{(clan\_disr,provcd)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1,145 x 3
##    provcd lnzupunum50 countycode
##     <dbl>       <dbl>      <dbl>
##  1     13      0.0421          1
##  2     13      0               3
##  3     13      0               9
##  4     13      0              18
##  5     13      0.105          23
##  6     13      0.203          26
##  7     13      0.310          42
##  8     13      0.160          44
##  9     13      0.0281         48
## 10     13      0              70
## # ... with 1,135 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(china)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Simple feature collection with 6 features and 13 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 115.4248 ymin: 39.44473 xmax: 116.8805 ymax: 41.05936
## Geodetic CRS:  WGS 84
## # A tibble: 6 x 14
##   Code_~1 Code_~2 Code_~3 Name_~4 Name_~5 Name_~6 Pinyin Pop_2~7 Pop_2~8 Pop_2~9
##   <chr>   <chr>   <chr>   <chr>   <chr>   <chr>   <chr>    <dbl>   <dbl>   <dbl>
## 1 110101  1101    11      北京市  <NA>    东城区  Dōngc~  881763  919253      NA
## 2 110102  1101    11      北京市  <NA>    西城区  Xīché~ 1232823 1243315      NA
## 3 110114  1101    11      北京市  <NA>    昌平区  Chāng~  614821 1660501      NA
## 4 110115  1101    11      北京市  <NA>    大兴区  Dàxīn~  671444 1365112      NA
## 5 110111  1101    11      北京市  <NA>    房山区  Fángs~  814367  944832      NA
## 6 110116  1101    11      北京市  <NA>    怀柔区  Huáir~  296002  372887      NA
## # ... with 4 more variables: Pop_2018 <dbl>, Area <dbl>, Density <dbl>,
## #   geometry <MULTIPOLYGON [°]>, and abbreviated variable names 1: Code_County,
## #   2: Code_Perfecture, 3: Code_Province, 4: Name_Province, 5: Name_Perfecture,
## #   6: Name_County, 7: Pop_2000, 8: Pop_2010, 9: Pop_2017
\end{verbatim}

\hypertarget{ux91cdux65b0ux518dux5229ux7528}{%
\section{重新再利用}\label{ux91cdux65b0ux518dux5229ux7528}}

尽管我们没有关于县级层面的宏观经济等控制变量，但我们可以将获得的数据反向匹配给到个人，看宗族祠堂对于个人的影响是如何呈现的。

我们这里选择使用cfps2014年的数据，处理方法基本上与2010年一致。

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cfps2014comm }\OtherTok{\textless{}{-}} \FunctionTok{read\_dta}\NormalTok{(}\StringTok{"/Users/a182501/rproject/cfps/data/cfps/2014/cfps2014comm\_201906.dta"}\NormalTok{)}
\NormalTok{cfps2014comm}\SpecialCharTok{$}\NormalTok{ca3\_s\_6[}\FunctionTok{which}\NormalTok{(cfps2014comm}\SpecialCharTok{$}\NormalTok{ca3\_s\_6}\SpecialCharTok{=={-}}\DecValTok{8}\NormalTok{)] }\OtherTok{\textless{}{-}} \DecValTok{0}
\NormalTok{cfps2014comm}\SpecialCharTok{$}\NormalTok{ca3\_s\_7[}\FunctionTok{which}\NormalTok{(cfps2014comm}\SpecialCharTok{$}\NormalTok{ca3\_s\_7}\SpecialCharTok{=={-}}\DecValTok{8}\NormalTok{)] }\OtherTok{\textless{}{-}} \DecValTok{0}
\CommentTok{\#View(cfps2014comm)随时观察变量}
\NormalTok{cfps2014comm}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(cid14,cid10,ca3\_s\_6,ca3\_s\_7)}\OtherTok{{-}\textgreater{}}\NormalTok{comm14}
\FunctionTok{head}\NormalTok{(comm14)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 4
##   cid14     cid10     ca3_s_6    ca3_s_7               
##   <dbl+lbl> <dbl+lbl> <dbl+lbl>  <dbl+lbl>             
## 1 118100    11810     0           0                    
## 2 118200    11820     0           0                    
## 3 212300    21230     7 [通公路] 12 [实施村/居直接选举]
## 4 209100    20910     0           0                    
## 5 118300    11830     0           0                    
## 6 118400    11840     0           0
\end{verbatim}

调用家户数据

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{famconf14 }\OtherTok{\textless{}{-}} \FunctionTok{read\_dta}\NormalTok{(}\StringTok{"/Users/a182501/rproject/cfps/data/cfps/2014/cfps2014famconf\_170630.dta"}\NormalTok{)}
\FunctionTok{head}\NormalTok{(famconf14)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 307
##   fid14     fid12           fid10         provcd14 count~1 cid14  urban14 pid   
##   <dbl+lbl> <dbl+lbl>       <dbl+lbl>     <dbl+lb> <dbl+l> <dbl+> <dbl+l> <dbl+>
## 1 100051        -8 [不适用]     -8 [不适~ 11 [北~  45     624942 1 [城~ 1.00e8
## 2 100051        -8 [不适用]     -8 [不适~ 11 [北~  45     624942 1 [城~ 1.00e8
## 3 100051    110043          110043      ~ 11 [北~  45     624942 1 [城~ 1.10e8
## 4 100125    110147          110147      ~ 11 [北~ 170     564346 1 [城~ 1.10e8
## 5 100160    120009          120009      ~ 12 [天~  79     131700 1 [城~ 1.20e8
## 6 100286    130005          130005      ~ 13 [河~ 237     161210 1 [城~ 1.30e8
## # ... with 299 more variables: code_a_p <dbl+lbl>, tb2_a_p <dbl+lbl>,
## #   tb1y_a_p <dbl+lbl>, tb1m_a_p <dbl+lbl>, tb1a_a_p <dbl+lbl>,
## #   tb3_a14_p <dbl+lbl>, tb4_a14_p <dbl+lbl>, alive_a14_p <dbl+lbl>,
## #   ta4y_a14_p <dbl+lbl>, ta4m_a14_p <dbl+lbl>, ta401_a14_p <chr>,
## #   qa301_a14_p <dbl+lbl>, qa302_a14_p <dbl+lbl>, tb6_a14_p <dbl+lbl>,
## #   tb601_a14_p <dbl+lbl>, co_a14_p <dbl+lbl>, outpers_where14_p <dbl+lbl>,
## #   tb602acode_a14_p <dbl+lbl>, cfps2014_interv_p <dbl+lbl>, ...
\end{verbatim}

使用左连接\texttt{left\_join}以保留我们的家户信息，用村居样本代码\texttt{cid14}来进行匹配。

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(visdat)}

\NormalTok{famcon14\_clan }\OtherTok{\textless{}{-}} \FunctionTok{left\_join}\NormalTok{(famconf14,comm14,}\AttributeTok{by=}\StringTok{"cid14"}\NormalTok{)}
\FunctionTok{dim}\NormalTok{(famcon14\_clan)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 57734   310
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(famconf14)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 57734   307
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#View(famcon14\_clan)}
\NormalTok{famcon14\_clan}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(cid14,cid10,ca3\_s\_6,ca3\_s\_7,tb2\_a\_p,tb1y\_a\_p,cfps2014\_interv\_p,tb4\_a14\_p,urban14,tb4\_a14\_f)}\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(urban14}\SpecialCharTok{==}\DecValTok{0}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(tb4\_a14\_p}\SpecialCharTok{!={-}}\DecValTok{8}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(tb4\_a14\_p}\SpecialCharTok{!={-}}\DecValTok{9}\NormalTok{)}\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(cid10))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{age=}\DecValTok{2014}\SpecialCharTok{{-}}\NormalTok{tb1y\_a\_p)}\SpecialCharTok{\%\textgreater{}\%}
  
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{eduyear =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    tb4\_a14\_p}\SpecialCharTok{==}\DecValTok{8} \SpecialCharTok{\textasciitilde{}} \DecValTok{23}\NormalTok{,}
\NormalTok{    tb4\_a14\_p}\SpecialCharTok{==}\DecValTok{7} \SpecialCharTok{\textasciitilde{}} \DecValTok{19}\NormalTok{,}
\NormalTok{    tb4\_a14\_p}\SpecialCharTok{==}\DecValTok{6} \SpecialCharTok{\textasciitilde{}} \DecValTok{16}\NormalTok{,}
\NormalTok{    tb4\_a14\_p}\SpecialCharTok{==}\DecValTok{5} \SpecialCharTok{\textasciitilde{}} \DecValTok{15}\NormalTok{,}
\NormalTok{    tb4\_a14\_p}\SpecialCharTok{==}\DecValTok{4} \SpecialCharTok{\textasciitilde{}} \DecValTok{12}\NormalTok{,}
\NormalTok{    tb4\_a14\_p}\SpecialCharTok{==}\DecValTok{3} \SpecialCharTok{\textasciitilde{}} \DecValTok{9}\NormalTok{,}
\NormalTok{    tb4\_a14\_p}\SpecialCharTok{==}\DecValTok{2} \SpecialCharTok{\textasciitilde{}} \DecValTok{6}\NormalTok{,}
\NormalTok{    tb4\_a14\_p}\SpecialCharTok{==}\DecValTok{1} \SpecialCharTok{\textasciitilde{}} \DecValTok{0}
\NormalTok{  ))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{temple\_dummy =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    ca3\_s\_6}\SpecialCharTok{==}\DecValTok{0}\SpecialCharTok{\textasciitilde{}}\DecValTok{0}\NormalTok{,}
\NormalTok{    ca3\_s\_6}\SpecialCharTok{\textgreater{}}\DecValTok{0}\SpecialCharTok{\textasciitilde{}}\DecValTok{1}
\NormalTok{  ))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{genealogy\_dummy =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    ca3\_s\_7 }\SpecialCharTok{==} \DecValTok{0}\SpecialCharTok{\textasciitilde{}}\DecValTok{0}\NormalTok{,}
\NormalTok{    ca3\_s\_7 }\SpecialCharTok{\textgreater{}} \DecValTok{0}\SpecialCharTok{\textasciitilde{}}\DecValTok{1}
\NormalTok{  ))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{eduyear\_fa =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    tb4\_a14\_f}\SpecialCharTok{==}\DecValTok{8} \SpecialCharTok{\textasciitilde{}} \DecValTok{23}\NormalTok{,}
\NormalTok{    tb4\_a14\_f}\SpecialCharTok{==}\DecValTok{7} \SpecialCharTok{\textasciitilde{}} \DecValTok{19}\NormalTok{,}
\NormalTok{    tb4\_a14\_f}\SpecialCharTok{==}\DecValTok{6} \SpecialCharTok{\textasciitilde{}} \DecValTok{16}\NormalTok{,}
\NormalTok{    tb4\_a14\_f}\SpecialCharTok{==}\DecValTok{5} \SpecialCharTok{\textasciitilde{}} \DecValTok{15}\NormalTok{,}
\NormalTok{    tb4\_a14\_f}\SpecialCharTok{==}\DecValTok{4} \SpecialCharTok{\textasciitilde{}} \DecValTok{12}\NormalTok{,}
\NormalTok{    tb4\_a14\_f}\SpecialCharTok{==}\DecValTok{3} \SpecialCharTok{\textasciitilde{}} \DecValTok{9}\NormalTok{,}
\NormalTok{    tb4\_a14\_f}\SpecialCharTok{==}\DecValTok{2} \SpecialCharTok{\textasciitilde{}} \DecValTok{6}\NormalTok{,}
\NormalTok{    tb4\_a14\_f}\SpecialCharTok{==}\DecValTok{1} \SpecialCharTok{\textasciitilde{}} \DecValTok{0}
\NormalTok{  ))}\OtherTok{{-}\textgreater{}}\NormalTok{ facon14\_clan\_clean}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(facon14\_clan\_clean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 29190    15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(}\FunctionTok{table}\NormalTok{(facon14\_clan\_clean}\SpecialCharTok{$}\NormalTok{eduyear))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 27780
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(facon14\_clan\_clean}\SpecialCharTok{$}\NormalTok{eduyear\_fa)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##    0    6    9   12   15   16   19   23 
## 9139 6435 5176 1850  284  109    4    1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(facon14\_clan\_clean}\SpecialCharTok{$}\NormalTok{temple\_dummy)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##     0     1 
## 28033  1157
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colnames}\NormalTok{(facon14\_clan\_clean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "cid14"             "cid10"             "ca3_s_6"          
##  [4] "ca3_s_7"           "tb2_a_p"           "tb1y_a_p"         
##  [7] "cfps2014_interv_p" "tb4_a14_p"         "urban14"          
## [10] "tb4_a14_f"         "age"               "eduyear"          
## [13] "temple_dummy"      "genealogy_dummy"   "eduyear_fa"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{reg\_temple }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(}\AttributeTok{data =}\NormalTok{ facon14\_clan\_clean,eduyear}\SpecialCharTok{\textasciitilde{}}\NormalTok{temple\_dummy}\SpecialCharTok{+}\NormalTok{age}\SpecialCharTok{+}\NormalTok{tb2\_a\_p)}\CommentTok{\# 控制母亲的受教育水平/父亲的受教育水平}
\FunctionTok{summary}\NormalTok{(reg\_temple)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = eduyear ~ temple_dummy + age + tb2_a_p, data = facon14_clan_clean)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.9472 -4.8059  0.3229  3.3196 14.2842 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(>|t|)    
## (Intercept)   4.6291262  0.0459993 100.635   <2e-16 ***
## temple_dummy -0.2351321  0.1448925  -1.623    0.105    
## age           0.0033346  0.0003746   8.903   <2e-16 ***
## tb2_a_p       0.9879641  0.0534791  18.474   <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 4.714 on 27776 degrees of freedom
##   (1410 observations deleted due to missingness)
## Multiple R-squared:  0.0123, Adjusted R-squared:  0.0122 
## F-statistic: 115.3 on 3 and 27776 DF,  p-value: < 2.2e-16
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{reg\_genealogy }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(}\AttributeTok{data =}\NormalTok{ facon14\_clan\_clean,eduyear}\SpecialCharTok{\textasciitilde{}}\NormalTok{genealogy\_dummy}\SpecialCharTok{+}\NormalTok{age}\SpecialCharTok{+}\NormalTok{tb2\_a\_p)}
\FunctionTok{summary}\NormalTok{(reg\_genealogy)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = eduyear ~ genealogy_dummy + age + tb2_a_p, data = facon14_clan_clean)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.9464 -4.8052  0.3202  3.3202 14.2848 
## 
## Coefficients:
##                   Estimate Std. Error t value Pr(>|t|)    
## (Intercept)      4.6285474  0.0459432 100.745   <2e-16 ***
## genealogy_dummy -0.2627547  0.1583737  -1.659   0.0971 .  
## age              0.0033325  0.0003746   8.897   <2e-16 ***
## tb2_a_p          0.9879593  0.0534790  18.474   <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 4.714 on 27776 degrees of freedom
##   (1410 observations deleted due to missingness)
## Multiple R-squared:  0.01231,    Adjusted R-squared:  0.0122 
## F-statistic: 115.4 on 3 and 27776 DF,  p-value: < 2.2e-16
\end{verbatim}

还是对族谱的回归会微弱显著，不过都是负的系数，和一些学者之前研究的结论有一些差别，但可能是在这里控制变量控制的不够，可能存在内生性问题，比如遗漏一些关键的控制变量，受访者的智力水平、家庭规模，父亲的政治背景、教育理念、文化资本等。

不过个人认为这里可以使用族谱的数量，并不需要将其转变为虚拟变量。

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{reg\_genealogy\_cont }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(}\AttributeTok{data =}\NormalTok{ facon14\_clan\_clean,eduyear}\SpecialCharTok{\textasciitilde{}}\NormalTok{ca3\_s\_7}\SpecialCharTok{+}\NormalTok{age}\SpecialCharTok{+}\NormalTok{tb2\_a\_p)}
\FunctionTok{summary}\NormalTok{(reg\_genealogy\_cont)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = eduyear ~ ca3_s_7 + age + tb2_a_p, data = facon14_clan_clean)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.9476 -4.8062  0.3191  3.3191 14.2838 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(>|t|)    
## (Intercept)  4.6294935  0.0459205 100.815   <2e-16 ***
## ca3_s_7     -0.0323995  0.0169295  -1.914   0.0557 .  
## age          0.0033338  0.0003746   8.901   <2e-16 ***
## tb2_a_p      0.9880811  0.0534782  18.476   <2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 4.713 on 27776 degrees of freedom
##   (1410 observations deleted due to missingness)
## Multiple R-squared:  0.01234,    Adjusted R-squared:  0.01223 
## F-statistic: 115.7 on 3 and 27776 DF,  p-value: < 2.2e-16
\end{verbatim}

\hypertarget{charls}{%
\chapter{CHARLS}\label{charls}}

\href{http://charls.pku.edu.cn/}{CHARLS}是中国中老年人调查数据，由北大发起的关于中国中老年人的社会调查。

\hypertarget{ux6570ux636eux5bfcux5165}{%
\section{数据导入}\label{ux6570ux636eux5bfcux5165}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(haven)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{getwd}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "/Users/a182501/rproject/rrp"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{charls2018cogn }\OtherTok{\textless{}{-}} \FunctionTok{read\_dta}\NormalTok{(}\StringTok{"data/charls/2018/Cognition.dta"}\NormalTok{)}
\FunctionTok{head}\NormalTok{(charls2018cogn)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 219
##   ID     house~1 commu~2 dc001~3 dc002~4 dc003~5 dc005~6 dc006~7 dc007~8 dc008~9
##   <chr>  <chr>   <chr>   <dbl+l> <dbl+l> <dbl+l> <dbl+l> <dbl+l> <dbl+l> <dbl+l>
## 1 09400~ 094004~ 0940041 1 [1 C~ 1 [1 C~ 5 [5 E~ 1 [1 C~ 1 [1 C~ 1 [1 C~ 1 [1 C~
## 2 09400~ 094004~ 0940041 1 [1 C~ 1 [1 C~ 1 [1 C~ 1 [1 C~ 1 [1 C~ 1 [1 C~ 1 [1 C~
## 3 09400~ 094004~ 0940041 1 [1 C~ 1 [1 C~ 1 [1 C~ 1 [1 C~ 1 [1 C~ 1 [1 C~ 1 [1 C~
## 4 09400~ 094004~ 0940041 1 [1 C~ 1 [1 C~ 1 [1 C~ 1 [1 C~ 1 [1 C~ 1 [1 C~ 1 [1 C~
## 5 09400~ 094004~ 0940041 1 [1 C~ 1 [1 C~ 5 [5 E~ 1 [1 C~ 1 [1 C~ 1 [1 C~ 1 [1 C~
## 6 09400~ 094004~ 0940041 1 [1 C~ 1 [1 C~ 1 [1 C~ 1 [1 C~ 1 [1 C~ 1 [1 C~ 1 [1 C~
## # ... with 209 more variables: dc009_w4 <dbl+lbl>, dc010_w4 <dbl+lbl>,
## #   dc012_w4 <dbl+lbl>, dc004 <dbl+lbl>, dc013_w4_1_s1 <dbl+lbl>,
## #   dc013_w4_1_s2 <dbl+lbl>, dc013_w4_1_s3 <dbl+lbl>, dc013_w4_1_s4 <dbl+lbl>,
## #   dc013_w4_1_s97 <dbl+lbl>, dc013_w4_2_s1 <dbl+lbl>, dc013_w4_2_s2 <dbl+lbl>,
## #   dc013_w4_2_s3 <dbl+lbl>, dc013_w4_2_s4 <dbl+lbl>, dc013_w4_2_s97 <dbl+lbl>,
## #   dc013_w4_3_s1 <dbl+lbl>, dc013_w4_3_s2 <dbl+lbl>, dc013_w4_3_s3 <dbl+lbl>,
## #   dc013_w4_3_s4 <dbl+lbl>, dc013_w4_3_s97 <dbl+lbl>, ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(purrr)}
\NormalTok{get\_var\_label }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(dta) \{}
\NormalTok{  labels }\OtherTok{\textless{}{-}} \FunctionTok{map}\NormalTok{(dta, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{attr}\NormalTok{(x, }\StringTok{"label"}\NormalTok{))}
  \FunctionTok{data\_frame}\NormalTok{(}
    \AttributeTok{name =} \FunctionTok{names}\NormalTok{(labels),}
    \AttributeTok{label =} \FunctionTok{as.character}\NormalTok{(labels)}
\NormalTok{  )}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{ux6587ux732eux590dux523bux65b0ux578bux519cux6751ux793eux4f1aux517bux8001ux4fddux9669ux653fux7b56ux6548ux679cux8bc4ux4f30}{%
\chapter{文献复刻：《新型农村社会养老保险政策效果评估》}\label{ux6587ux732eux590dux523bux65b0ux578bux519cux6751ux793eux4f1aux517bux8001ux4fddux9669ux653fux7b56ux6548ux679cux8bc4ux4f30}}

这篇文章是使用断点回归和DID的方法，

实际上是利用领取养老金的年龄规则，只有年满60周岁的参保人员才能领取

因变量：家户总收入、家户人均收入、个人收入、个人非劳动收入；

\hypertarget{ux6570ux636eux5bfcux5165-1}{%
\section{数据导入}\label{ux6570ux636eux5bfcux5165-1}}

\hypertarget{chfs}{%
\chapter{CHFS}\label{chfs}}

\href{https://chfs.swufe.edu.cn/}{CHFS}是西南财经大学组织的中国家庭金融调查。中国家
庭金融调查采用三阶段、分层、与人口规模成比例(PPS)的抽样方法，通过科学抽样、现
代调查技术和调查管理手段，收集中国家庭金融微观信息，为国内外研究者提供研究
中国家庭金融问题的高质量微观数据。
CHFS样本覆盖全国29个省，262个县，总共包含28000多户家庭的资产负债、收入与支出、保险与保障，家庭人口特征及就业等方面详细信息的大型微观数据。

\hypertarget{ux6570ux636eux8bfbux53d6}{%
\section{数据读取}\label{ux6570ux636eux8bfbux53d6}}

从其官网下载2019年的调查数据

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(haven)}
\NormalTok{chfs\_hh2019 }\OtherTok{\textless{}{-}} \FunctionTok{read\_dta}\NormalTok{(}\StringTok{"data/chfs/CHFS\_2019/chfs2019\_hh\_202112.dta"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(purrr)}
\NormalTok{get\_var\_label }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(dta) \{}
\NormalTok{  labels }\OtherTok{\textless{}{-}} \FunctionTok{map}\NormalTok{(dta, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{attr}\NormalTok{(x, }\StringTok{"label"}\NormalTok{))}
  \FunctionTok{tibble}\NormalTok{(}
    \AttributeTok{name =} \FunctionTok{names}\NormalTok{(labels),}
    \AttributeTok{label =} \FunctionTok{as.character}\NormalTok{(labels)}
\NormalTok{  )}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{ux6784ux5efaux53d8ux91cf}{%
\section{构建变量}\label{ux6784ux5efaux53d8ux91cf}}

\hypertarget{ux793eux4f1aux4e92ux52a8}{%
\subsection{社会互动}\label{ux793eux4f1aux4e92ux52a8}}

\begin{itemize}
\item
  Du et al.~(2014)
\item
  社会互动相关的礼金支出、外出就餐支出、娱乐支出、通讯支出、交通支出、旅游
  探亲支出、兄弟姐妹数量、与父母通话次数 8 个变量。
\end{itemize}

\hypertarget{ux91d1ux878dux77e5ux8bc6}{%
\subsection{金融知识}\label{ux91d1ux878dux77e5ux8bc6}}

在CHFS中第五部分就是关于金融知识、底层治理与主观评价。

\includegraphics{image/fin-know.png}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{chfs\_hh2013 }\OtherTok{\textless{}{-}} \FunctionTok{read\_dta}\NormalTok{(}\StringTok{"data/chfs/CHFS\_2013/chfs2013\_hh\_20191120\_version14.dta"}\NormalTok{)}
\NormalTok{chfs\_hh2013}\SpecialCharTok{\%\textgreater{}\%}\FunctionTok{get\_var\_label}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2,184 x 2
##    name      label                 
##    <chr>     <chr>                 
##  1 hhid_2011 household id in 2011  
##  2 hhid_2013 household id in 2013  
##  3 a2000a    居住在一起家庭成员个数
##  4 a2000b    外出家庭成员个数      
##  5 a1001     地址是否正确          
##  6 a1002     是否居民住宅          
##  7 a1003     住宅户数              
##  8 a1007     主要经济活动          
##  9 a1008     是否常住本市          
## 10 a1009     有无外国国籍          
## # ... with 2,174 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(chfs\_hh2013)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 28141  2184
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{chfs\_hh2013}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"a400"}\NormalTok{))}\OtherTok{{-}\textgreater{}}\NormalTok{df2\_a}
\NormalTok{df2\_na }\OtherTok{\textless{}{-}} \FunctionTok{na.omit}\NormalTok{(df2\_a) }
\FunctionTok{dim}\NormalTok{(df2\_na)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 26922     7
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df2\_na}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{get\_var\_label}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 7 x 2
##   name    label                             
##   <chr>   <chr>                             
## 1 a4002a  对经济、金融信息的关注度          
## 2 a4002b  上学期间是否上过经济、金融课程    
## 3 a4003   投资风险态度                      
## 4 a4004a  100元存5年的本息和                
## 5 a4005a  100元存款一年后的购买力           
## 6 a4006a  100%得4000和50%得10000的偏好      
## 7 a4007aa 单买一只股票和买一只股票基金的风险
\end{verbatim}

参考 \textcite{ZhangGoDong2016} 的做法：

\includegraphics{image/fin-know2.png}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df2\_na}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{fa1=}\FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    a4002a}\SpecialCharTok{\%in\%}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{)}\SpecialCharTok{\textasciitilde{}}\DecValTok{1}\NormalTok{,}
\NormalTok{    a4002a}\SpecialCharTok{\%in\%}\FunctionTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{)}\SpecialCharTok{\textasciitilde{}}\DecValTok{0}
\NormalTok{  ))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{fa2 =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    a4002b}\SpecialCharTok{==}\DecValTok{1}\SpecialCharTok{\textasciitilde{}}\DecValTok{1}\NormalTok{,}
\NormalTok{    a4002b}\SpecialCharTok{==}\DecValTok{2}\SpecialCharTok{\textasciitilde{}}\DecValTok{0}
\NormalTok{  ))}\SpecialCharTok{\%\textgreater{}\%}
   \FunctionTok{mutate}\NormalTok{(}\AttributeTok{fa3 =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    a4007aa}\SpecialCharTok{==}\DecValTok{1}\SpecialCharTok{\textasciitilde{}}\DecValTok{1}\NormalTok{,}
\NormalTok{    a4007aa}\SpecialCharTok{!=}\DecValTok{1}\SpecialCharTok{\textasciitilde{}}\DecValTok{0}
\NormalTok{  ))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{fa4=}\FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    a4004a}\SpecialCharTok{==}\DecValTok{2}\SpecialCharTok{\textasciitilde{}}\DecValTok{1}\NormalTok{,}
\NormalTok{    a4004a}\SpecialCharTok{!=}\DecValTok{2}\SpecialCharTok{\textasciitilde{}}\DecValTok{0}
\NormalTok{  ))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{fa5=}\FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    a4006a}\SpecialCharTok{==}\DecValTok{2}\SpecialCharTok{\textasciitilde{}}\DecValTok{1}\NormalTok{,}
\NormalTok{    a4006a}\SpecialCharTok{==}\DecValTok{1}\SpecialCharTok{\textasciitilde{}}\DecValTok{0}
\NormalTok{  ))}\SpecialCharTok{\%\textgreater{}\%}
   \FunctionTok{mutate}\NormalTok{(}\AttributeTok{fa6=}\FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    a4005a}\SpecialCharTok{==}\DecValTok{1}\SpecialCharTok{\textasciitilde{}}\DecValTok{1}\NormalTok{,}
\NormalTok{    a4005a}\SpecialCharTok{!=}\DecValTok{1}\SpecialCharTok{\textasciitilde{}}\DecValTok{0}
\NormalTok{  ))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"fa"}\NormalTok{))}\OtherTok{{-}\textgreater{}}\NormalTok{df\_fa}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(visdat)}
\NormalTok{df\_fa }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{vis\_dat}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{06-cfps_files/figure-latex/unnamed-chunk-6-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mean\_fa }\OtherTok{\textless{}{-}} \FunctionTok{map\_dbl}\NormalTok{(df\_fa,mean)}
\NormalTok{mean\_fa}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        fa1        fa2        fa3        fa4        fa5        fa6 
## 0.37118342 0.08160612 0.30740658 0.15474333 0.26799643 0.16072357
\end{verbatim}

得到的均值水平会比原文章都普遍较高一些。但因素5的偏差较大。（但本人又认为这个变量不太好，更像是一个风险测试的问题，与受访者的风险偏好有关，并没有一个所谓正确的答案）

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1}\SpecialCharTok{{-}}\NormalTok{mean\_fa[}\DecValTok{5}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       fa5 
## 0.7320036
\end{verbatim}

\hypertarget{ux56e0ux5b50ux8f6cux6362}{%
\subsubsection{因子转换}\label{ux56e0ux5b50ux8f6cux6362}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(psych) }\CommentTok{\#KMO和Bartlette检验所需包}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'psych'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:ggplot2':
## 
##     %+%, alpha
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{KMO}\NormalTok{(df\_fa)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Kaiser-Meyer-Olkin factor adequacy
## Call: KMO(r = df_fa)
## Overall MSA =  0.65
## MSA for each item = 
##  fa1  fa2  fa3  fa4  fa5  fa6 
## 0.64 0.64 0.66 0.69 0.70 0.70
\end{verbatim}

都大于0.6，勉强适合。

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{bartlett.test}\NormalTok{(df\_fa)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##  Bartlett test of homogeneity of variances
## 
## data:  df_fa
## Bartlett's K-squared = 10938, df = 5, p-value < 2.2e-16
\end{verbatim}

p值非常小，也验证可以做因子。

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{corr}\OtherTok{=}\FunctionTok{cor}\NormalTok{(df\_fa)}
\NormalTok{eig}\OtherTok{=}\FunctionTok{eigen}\NormalTok{(corr)}
\NormalTok{(}\AttributeTok{ccx=}\NormalTok{(eig}\SpecialCharTok{$}\NormalTok{va)}\SpecialCharTok{/}\FunctionTok{sum}\NormalTok{(eig}\SpecialCharTok{$}\NormalTok{va))  }\CommentTok{\#贡献率}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.2677825 0.1643641 0.1626099 0.1501068 0.1306874 0.1244494
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\AttributeTok{cx=}\FunctionTok{cumsum}\NormalTok{(eig}\SpecialCharTok{$}\NormalTok{va)}\SpecialCharTok{/}\FunctionTok{sum}\NormalTok{(eig}\SpecialCharTok{$}\NormalTok{va)) }\CommentTok{\#累计方差贡献率}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.2677825 0.4321466 0.5947564 0.7448632 0.8755506 1.0000000
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit }\OtherTok{\textless{}{-}} \FunctionTok{factanal}\NormalTok{(df\_fa, }\DecValTok{3}\NormalTok{, }\AttributeTok{rotation=}\StringTok{"promax"}\NormalTok{) }\CommentTok{\# 第2个参数是提取的因子个数}
\FunctionTok{print}\NormalTok{(fit, }\AttributeTok{digits=}\DecValTok{2}\NormalTok{, }\AttributeTok{sort=}\ConstantTok{TRUE}\NormalTok{) }\CommentTok{\# 输出结果}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## factanal(x = df_fa, factors = 3, rotation = "promax")
## 
## Uniquenesses:
##  fa1  fa2  fa3  fa4  fa5  fa6 
## 0.74 0.75 0.80 0.00 0.95 0.92 
## 
## Loadings:
##     Factor1 Factor2 Factor3
## fa4  1.00                  
## fa1          0.38    0.18  
## fa2          0.49          
## fa3          0.34    0.15  
## fa5                  0.22  
## fa6                  0.30  
## 
##                Factor1 Factor2 Factor3
## SS loadings       0.99    0.51    0.20
## Proportion Var    0.17    0.08    0.03
## Cumulative Var    0.17    0.25    0.28
## 
## Factor Correlations:
##         Factor1 Factor2 Factor3
## Factor1    1.00    0.17    0.23
## Factor2    0.17    1.00    0.58
## Factor3    0.23    0.58    1.00
## 
## The degrees of freedom for the model is 0 and the fit was 0
\end{verbatim}

\hypertarget{ux91d1ux878dux6392ux65a5}{%
\subsection{金融排斥}\label{ux91d1ux878dux6392ux65a5}}

``是否有金融账户''来作为是否是存在金融排斥的代理变量。

\includegraphics{image/account.png}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{chfs\_hh2013 }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(d1101)}\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(d1101))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{cur=} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    d1101 }\SpecialCharTok{==} \DecValTok{1}\SpecialCharTok{\textasciitilde{}}\DecValTok{1}\NormalTok{,}
\NormalTok{    d1101 }\SpecialCharTok{==} \DecValTok{2}\SpecialCharTok{\textasciitilde{}}\DecValTok{0}
\NormalTok{  ))}\OtherTok{{-}\textgreater{}}\NormalTok{df3}
\FunctionTok{mean}\NormalTok{(df3}\SpecialCharTok{$}\NormalTok{cur)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.595189
\end{verbatim}

也就是有人民币活期存款账户的有59.51\%。但根据文章中的定义：还需要对其余的金融账户进行筛选，通过逻辑运算实现。

\includegraphics{image/exclude.png}

\hypertarget{ux5176ux4ed6ux6765ux6e90ux6570ux636e}{%
\chapter{其他来源数据}\label{ux5176ux4ed6ux6765ux6e90ux6570ux636e}}

其他数据来源包括相关领域内的学者对于在其文章中的数据以及公开的数据集中的数据。
比如哈佛大学的王教授收集了关于地方的数据

\hypertarget{ux65b9ux8a00ux6570ux636e}{%
\section{方言数据}\label{ux65b9ux8a00ux6570ux636e}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(mapchina)}
\FunctionTok{library}\NormalTok{(sysfonts)}
\FunctionTok{library}\NormalTok{(showtextdb)}
\FunctionTok{library}\NormalTok{(showtext)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(sf)}
\end{Highlighting}
\end{Shaded}

徐现祥老师在其个人网站上公开了其地方的方言数据，也就是
连享会gitee仓库有\href{https://gitee.com/arlionn/IRE/tree/master/}{相关数据集合}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(haven)}
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{read\_dta}\NormalTok{(}\StringTok{"data/China\_dialect\_diversity\_index.dta"}\NormalTok{)}
\FunctionTok{head}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 3
##   city             diversity1 diversity2
##   <dbl+lbl>             <dbl>      <dbl>
## 1 256 [阿勒泰地区]      0.650          2
## 2  75 [安康市]          0.475          2
## 3  74 [安庆市]          0.477          2
## 4  77 [安顺市]          0.570          1
## 5  76 [安阳市]          0.463          2
## 6 261 [鞍山市]          0.428          3
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lab }\OtherTok{\textless{}{-}} \FunctionTok{attributes}\NormalTok{(df}\SpecialCharTok{$}\NormalTok{city)}\SpecialCharTok{$}\NormalTok{labels}
\NormalTok{lab }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(lab)}
\NormalTok{lab\_name }\OtherTok{\textless{}{-}} \FunctionTok{rownames}\NormalTok{(lab)}
\NormalTok{lab\_df }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(lab,lab\_name)}
\FunctionTok{colnames}\NormalTok{(lab\_df) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"city"}\NormalTok{,}\StringTok{"city\_name"}\NormalTok{)}
\NormalTok{df\_lab }\OtherTok{\textless{}{-}} \FunctionTok{merge}\NormalTok{(df,lab\_df,}\AttributeTok{by =} \StringTok{"city"}\NormalTok{)}
\FunctionTok{head}\NormalTok{(df\_lab)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   city diversity1 diversity2 city_name
## 1    1     0.1071          1  七台河市
## 2    2     0.5067          1    三亚市
## 3    3     0.4763          2  三门峽市
## 4    4     0.0126          1    上海市
## 5    5     0.5792          4    上饶市
## 6    6     0.0603          1    东莞市
\end{verbatim}

我们这里使用的是\href{https://github.com/xmc811/mapchina}{mapchina}包，能够在不同的行政层级上绘制中国区划地图。

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sf\_use\_s2}\NormalTok{(}\ConstantTok{FALSE}\NormalTok{)}
\NormalTok{df1 }\OtherTok{\textless{}{-}}\NormalTok{ china}\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(china}\SpecialCharTok{$}\NormalTok{Name\_Perfecture))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Name\_Perfecture=}\NormalTok{Name\_Province)}

\NormalTok{df2 }\OtherTok{\textless{}{-}}\NormalTok{ china}\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(china}\SpecialCharTok{$}\NormalTok{Name\_Perfecture)}\SpecialCharTok{==}\NormalTok{F)}

\NormalTok{df3 }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(df1,df2)}
\FunctionTok{dim}\NormalTok{(df3)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2901   14
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(china)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2901   14
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df3\_perf }\OtherTok{\textless{}{-}}\NormalTok{ df3 }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(Name\_Perfecture) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{geometry =} \FunctionTok{st\_union}\NormalTok{(geometry))}
\FunctionTok{colnames}\NormalTok{(df\_lab) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"city"}\NormalTok{,}\StringTok{"d1"}\NormalTok{,}\StringTok{"d2"}\NormalTok{,}\StringTok{"Name\_Perfecture"}\NormalTok{)}
\NormalTok{df\_all }\OtherTok{\textless{}{-}} \FunctionTok{left\_join}\NormalTok{(df3\_perf,df\_lab,}\AttributeTok{by =} \StringTok{"Name\_Perfecture"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

地区的不同方言类别：

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ df\_all) }\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ d2)) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_distiller}\NormalTok{(}\AttributeTok{palette =} \StringTok{"YlOrRd"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{07-other-data_files/figure-latex/unnamed-chunk-5-1.pdf}

地方方言的多样性指数：

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ df\_all) }\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{fill =}\NormalTok{ d1)) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_distiller}\NormalTok{(}\AttributeTok{palette =} \StringTok{"YlOrRd"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{07-other-data_files/figure-latex/unnamed-chunk-6-1.pdf}

\hypertarget{ux591cux95f4ux706fux5149ux6570ux636e}{%
\section{夜间灯光数据}\label{ux591cux95f4ux706fux5149ux6570ux636e}}

我们想要复刻一下上面的案例，但缺乏城市GDP数据，但我又懒于去用学校wind或数据网站上爬。就想要看下国内有没有可以用的API可以获得相关数据。

\hypertarget{ux83b7ux53d6ux65b9ux6cd5}{%
\subsection{获取方法}\label{ux83b7ux53d6ux65b9ux6cd5}}

nightlight data

\hypertarget{api}{%
\subsection{API}\label{api}}

\hypertarget{ux653fux6cbbux6570ux636e}{%
\section{政治数据}\label{ux653fux6cbbux6570ux636e}}

\hypertarget{ux8bbaux6587ux590dux523bclimate-risks-and-market-efficiency}{%
\chapter{\texorpdfstring{论文复刻\texttt{Climate\ risks\ and\ market\ efficiency}}{论文复刻Climate risks and market efficiency}}\label{ux8bbaux6587ux590dux523bclimate-risks-and-market-efficiency}}

\textcite{Hong2019} 这篇文章发表在JoE上，主要讲的是国家气候风险上升，使得国家的粮食价格得到下降，但并没有反映在实际的价格上，存在一定的非完全有效市场。

\hypertarget{data}{%
\section{Data}\label{data}}

数据来自于Harrison Hong的\href{http://www.columbia.edu/~hh2679/}{homepage} 同样也有do file。

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{getwd}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "/Users/a182501/rproject/rrp"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(haven)}
\NormalTok{pdsi }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"data/honglixu\_2019/PDSI\_world.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

PDSI数据也可以从\href{https://www.esrl.noaa.gov/psd/data/gridded/data.pdsi.html}{NOAA}中获取，不过需要注册，经过审核之后就可以免费下载。

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdsi}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(Date,Peru)}\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(Peru}\SpecialCharTok{!={-}}\DecValTok{999}\NormalTok{)}\OtherTok{{-}\textgreater{}}\NormalTok{pdsi\_peru}
\FunctionTok{library}\NormalTok{(xts)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: zoo
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'zoo'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:base':
## 
##     as.Date, as.Date.numeric
\end{verbatim}

\begin{verbatim}
## 
## ################################### WARNING ###################################
## # We noticed you have dplyr installed. The dplyr lag() function breaks how    #
## # base R's lag() function is supposed to work, which breaks lag(my_xts).      #
## #                                                                             #
## # Calls to lag(my_xts) that you enter or source() into this session won't     #
## # work correctly.                                                             #
## #                                                                             #
## # All package code is unaffected because it is protected by the R namespace   #
## # mechanism.                                                                  #
## #                                                                             #
## # Set `options(xts.warn_dplyr_breaks_lag = FALSE)` to suppress this warning.  #
## #                                                                             #
## # You can use stats::lag() to make sure you're not using dplyr::lag(), or you #
## # can add conflictRules('dplyr', exclude = 'lag') to your .Rprofile to stop   #
## # dplyr from breaking base R's lag() function.                                #
## ################################### WARNING ###################################
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'xts'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:dplyr':
## 
##     first, last
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdsi\_peru\_ts }\OtherTok{\textless{}{-}} \FunctionTok{as.xts}\NormalTok{(pdsi\_peru}\SpecialCharTok{$}\NormalTok{Peru,}\FunctionTok{as.Date}\NormalTok{(pdsi\_peru}\SpecialCharTok{$}\NormalTok{Date))}
\FunctionTok{plot}\NormalTok{(pdsi\_peru\_ts)}
\end{Highlighting}
\end{Shaded}

\includegraphics{08-rep-riskclimate_files/figure-latex/unnamed-chunk-2-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdsi}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(Date,New\_Zealand)}\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(New\_Zealand}\SpecialCharTok{!={-}}\DecValTok{999}\NormalTok{)}\OtherTok{{-}\textgreater{}}\NormalTok{pdsi\_nz}
\NormalTok{pdsi\_nz\_ts }\OtherTok{\textless{}{-}} \FunctionTok{as.xts}\NormalTok{(pdsi\_nz}\SpecialCharTok{$}\NormalTok{New\_Zealand,}\FunctionTok{as.Date}\NormalTok{(pdsi\_nz}\SpecialCharTok{$}\NormalTok{Date))}
\FunctionTok{plot}\NormalTok{(pdsi\_nz\_ts)}
\end{Highlighting}
\end{Shaded}

\includegraphics{08-rep-riskclimate_files/figure-latex/unnamed-chunk-3-1.pdf}

从数据中，我们可以看出有一定的趋势，尽管可能并不明显。
我们就可以从试图去构建一个含有线性时间固定趋势的模型。

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tt }\OtherTok{\textless{}{-}} \FunctionTok{seq}\NormalTok{(}\FunctionTok{length}\NormalTok{(pdsi\_nz\_ts))}
\NormalTok{reslm }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(}\FunctionTok{c}\NormalTok{(pdsi\_nz\_ts) }\SpecialCharTok{\textasciitilde{}}\NormalTok{ tt); }\FunctionTok{summary}\NormalTok{(reslm)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = c(pdsi_nz_ts) ~ tt)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -6.9739 -1.5492 -0.1941  1.7932  5.8579 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(>|t|)    
## (Intercept) -1.2921454  0.1212183 -10.660  < 2e-16 ***
## tt           0.0006777  0.0001521   4.457 8.98e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 2.25 on 1378 degrees of freedom
## Multiple R-squared:  0.01421,    Adjusted R-squared:  0.0135 
## F-statistic: 19.87 on 1 and 1378 DF,  p-value: 8.982e-06
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(tt, pdsi\_nz\_ts, }\AttributeTok{type=}\StringTok{"l"}\NormalTok{, }\AttributeTok{xlab=}\StringTok{"Time"}\NormalTok{, }\AttributeTok{ylab=}\StringTok{"PDSI in New Zealand"}\NormalTok{, }\AttributeTok{main=}\StringTok{"Fixed Linear Trend"}\NormalTok{)}
\FunctionTok{abline}\NormalTok{(reslm, }\AttributeTok{lwd=}\FloatTok{1.5}\NormalTok{, }\AttributeTok{col=}\StringTok{"red"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{08-rep-riskclimate_files/figure-latex/unnamed-chunk-5-1.pdf}

但固定趋势的模型可能并不精确，比如上述的线性固定趋势模型的R方就较小，拟合性较差。因此在文章中就使用每次的来\(b_{it}\)来构建。

第一个回归方程就是想要先构建一个趋势(\(Trend_{it}\))变量，通过AR(1)模型来实现

文章中是这样说的：
\includegraphics{data/honglixu_2019/p1.png}

后面的数据都是用1984-2019年的。

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{end\_date }\OtherTok{\textless{}{-}}\FunctionTok{which}\NormalTok{(pdsi}\SpecialCharTok{$}\NormalTok{Date}\SpecialCharTok{==}\StringTok{"2014/12/1"}\NormalTok{)}
\NormalTok{begin\_date }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{(pdsi}\SpecialCharTok{$}\NormalTok{Date}\SpecialCharTok{==}\StringTok{"1984/1/1"}\NormalTok{)}
\NormalTok{pdsi\_1984 }\OtherTok{\textless{}{-}}\NormalTok{ pdsi[begin\_date}\SpecialCharTok{:}\NormalTok{end\_date,]}
\FunctionTok{dim}\NormalTok{(pdsi\_1984)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 372  45
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#12*(2014{-}1984)+12}
\end{Highlighting}
\end{Shaded}

\begin{equation}
PDSI_{i,t} = a_i + b_{i}t+c_iPDSI_{i,t−1}+\epsilon_{i,t}
\tag{1}
\label{eq:1}
\end{equation}

其中的\(b_{i}\)就是希望捕捉的趋势变量，每到一个\(m\)进行一次rolling，可以获得从1900（或者更早）到m时期的\(Trend_{i,m}\)

作者还将滞后2，3期的回归附录放在\href{https://drive.google.com/file/d/0B0TDqU1VsbQNY0V1XzVFV0w5LW8/view?resourcekey=0-q8bSdARdVRdaCdbXMkfJkA}{Dropbox}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pdsi}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(Date,Australia)}\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(Australia}\SpecialCharTok{!={-}}\DecValTok{999}\NormalTok{)}\OtherTok{{-}\textgreater{}}\NormalTok{pdsi\_au}
\FunctionTok{head}\NormalTok{(pdsi\_au)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##       Date   Australia
## 1 1900/1/1 -3.31573868
## 2 1900/2/1 -4.25730371
## 3 1900/3/1 -0.01355382
## 4 1900/4/1  1.12726247
## 5 1900/5/1  2.32717538
## 6 1900/6/1  2.16344261
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{au\_ts }\OtherTok{\textless{}{-}} \FunctionTok{ts}\NormalTok{(pdsi\_au}\SpecialCharTok{$}\NormalTok{Australia, }
            \AttributeTok{start=}\FunctionTok{c}\NormalTok{(}\DecValTok{1900}\NormalTok{,}\DecValTok{1}\NormalTok{), }\AttributeTok{frequency=}\DecValTok{12}\NormalTok{)}

\FunctionTok{acf}\NormalTok{(au\_ts, }\AttributeTok{main=}\StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{08-rep-riskclimate_files/figure-latex/unnamed-chunk-7-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ar}\NormalTok{(au\_ts, }\AttributeTok{method=}\StringTok{"mle"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## ar(x = au_ts, method = "mle")
## 
## Coefficients:
##      1  
## 0.8759  
## 
## Order selected 1  sigma^2 estimated as  0.9384
\end{verbatim}

对于澳大利亚的数据给出的AR(1)模型。

\ref{eq:1} 的可以转换为\(Y_t = a + b*t + \epsilon_t\), where \(\epsilon_t = \phi\epsilon_{t-1}+\gamma_t\) a AR(1) process, where \(\epsilon_t\) is a white noise.

数据中有31个国家，也就是要做31次回归。。。太累了。

\hypertarget{ux6587ux732eux590dux523bthe-long-term-effects-of-africas-slave-trades}{%
\chapter{文献复刻：The Long-term Effects of Africa's Slave Trades}\label{ux6587ux732eux590dux523bthe-long-term-effects-of-africas-slave-trades}}

\textcite{Nunn2008} 这篇文献可称为是在学习IV时候的经典文献，2008年发表在QJE。

\hypertarget{ux6587ux732eux56deux987e-1}{%
\section{文献回顾}\label{ux6587ux732eux56deux987e-1}}

\hypertarget{ux6570ux636eux6765ux6e90}{%
\section{数据来源}\label{ux6570ux636eux6765ux6e90}}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{require}\NormalTok{(}\StringTok{"pacman"}\NormalTok{)) }\FunctionTok{install.packages}\NormalTok{(}\StringTok{"pacman"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: pacman
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pacman}\SpecialCharTok{::}\FunctionTok{p\_load}\NormalTok{(}
\NormalTok{  sf, }\CommentTok{\# vector data operations}
\NormalTok{  tidyverse, }\CommentTok{\# data wrangling}
\NormalTok{  units,}
\NormalTok{  rmapshaper,}
\NormalTok{  lwgeom,}
\NormalTok{  tictoc,}
\NormalTok{  haven}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#{-}{-}{-} coast line {-}{-}{-}\#}
\NormalTok{coast }\OtherTok{\textless{}{-}}
\NormalTok{  sf}\SpecialCharTok{::}\FunctionTok{st\_read}\NormalTok{(here}\SpecialCharTok{::}\FunctionTok{here}\NormalTok{(}\StringTok{"data/nunn\_2008/input/10m{-}coastline/10m\_coastline.shp"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{st\_transform}\NormalTok{(}\DecValTok{3857}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Reading layer `10m_coastline' from data source 
##   `/Users/a182501/rproject/rrp/data/nunn_2008/input/10m-coastline/10m_coastline.shp' 
##   using driver `ESRI Shapefile'
## Simple feature collection with 4177 features and 3 fields
## Geometry type: MULTILINESTRING
## Dimension:     XY
## Bounding box:  xmin: -180 ymin: -85.22198 xmax: 180 ymax: 83.6341
## Geodetic CRS:  WGS 84
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#{-}{-}{-} African countries {-}{-}{-}\#}
\NormalTok{countries }\OtherTok{\textless{}{-}}
\NormalTok{  sf}\SpecialCharTok{::}\FunctionTok{st\_read}\NormalTok{(here}\SpecialCharTok{::}\FunctionTok{here}\NormalTok{(}\StringTok{"data/nunn\_2008/input/gadm36\_africa/gadm36\_africa.shp"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{st\_transform}\NormalTok{(}\DecValTok{3857}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Reading layer `gadm36_africa' from data source 
##   `/Users/a182501/rproject/rrp/data/nunn_2008/input/gadm36_africa/gadm36_africa.shp' 
##   using driver `ESRI Shapefile'
## Simple feature collection with 54 features and 2 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -25.3618 ymin: -34.83514 xmax: 63.50347 ymax: 37.55986
## Geodetic CRS:  WGS 84
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#{-}{-}{-} ethnic regions {-}{-}{-}\#}
\NormalTok{ethnic\_regions }\OtherTok{\textless{}{-}}
\NormalTok{  sf}\SpecialCharTok{::}\FunctionTok{st\_read}\NormalTok{(here}\SpecialCharTok{::}\FunctionTok{here}\NormalTok{(}\StringTok{"data/nunn\_2008/input/Murdock\_shapefile/borders\_tribes.shp"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{st\_transform}\NormalTok{(}\DecValTok{3857}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Reading layer `borders_tribes' from data source 
##   `/Users/a182501/rproject/rrp/data/nunn_2008/input/Murdock_shapefile/borders_tribes.shp' 
##   using driver `ESRI Shapefile'
## Simple feature collection with 843 features and 4 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -25.35875 ymin: -34.82223 xmax: 63.50018 ymax: 37.53944
## Geodetic CRS:  WGS 84
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# lat/long for slave trade centers}
\NormalTok{trade\_centers }\OtherTok{\textless{}{-}}\NormalTok{ readxl}\SpecialCharTok{::}\FunctionTok{read\_xls}\NormalTok{(here}\SpecialCharTok{::}\FunctionTok{here}\NormalTok{(}\StringTok{"data/nunn\_2008/input/nunn2008.xls"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\hypertarget{ux8ba1ux7b97ux6700ux8fd1ux7684ux8d38ux6613ux8dddux79bb}{%
\section{计算最近的贸易距离}\label{ux8ba1ux7b97ux6700ux8fd1ux7684ux8d38ux6613ux8dddux79bb}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{countries\_simp }\OtherTok{\textless{}{-}}\NormalTok{ rmapshaper}\SpecialCharTok{::}\FunctionTok{ms\_simplify}\NormalTok{(countries)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}
\NormalTok{  g\_countries }\OtherTok{\textless{}{-}}
    \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ countries\_simp) }\SpecialCharTok{+}
    \FunctionTok{geom\_sf}\NormalTok{() }\SpecialCharTok{+}
    \FunctionTok{theme\_void}\NormalTok{()}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{09-rep-africa-slave-trade_files/figure-latex/unnamed-chunk-7-1.pdf}

用\texttt{st\_centroid()}来发现每一个国家的质心.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{countries\_centroid }\OtherTok{\textless{}{-}} \FunctionTok{st\_centroid}\NormalTok{(countries)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in st_centroid.sf(countries): st_centroid assumes attributes are
## constant over geometries of x
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ countries\_simp)}\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ countries\_centroid,}\AttributeTok{color=}\StringTok{\textquotesingle{}red\textquotesingle{}}\NormalTok{,}\AttributeTok{size =}\FloatTok{0.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{09-rep-africa-slave-trade_files/figure-latex/unnamed-chunk-8-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}
\NormalTok{  coast\_union }\OtherTok{\textless{}{-}} \FunctionTok{st\_union}\NormalTok{(coast)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Geometry set for 1 feature 
## Geometry type: MULTILINESTRING
## Dimension:     XY
## Bounding box:  xmin: -20037510 ymin: -20261860 xmax: 20037510 ymax: 18428920
## Projected CRS: WGS 84 / Pseudo-Mercator
\end{verbatim}

\begin{verbatim}
## MULTILINESTRING ((4926419 -2317631, 4926038 -23...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{minum\_dist\_to\_coast }\OtherTok{\textless{}{-}} \FunctionTok{st\_nearest\_points}\NormalTok{(countries\_centroid, coast\_union)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}
\NormalTok{  g\_min\_dist\_line }\OtherTok{\textless{}{-}}
    \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
    \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ countries\_simp) }\SpecialCharTok{+}
    \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ minum\_dist\_to\_coast, }\AttributeTok{color =} \StringTok{"red"}\NormalTok{) }\SpecialCharTok{+}
    \FunctionTok{theme\_void}\NormalTok{()}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{09-rep-africa-slave-trade_files/figure-latex/unnamed-chunk-11-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{closest\_pt\_on\_coast }\OtherTok{\textless{}{-}}\NormalTok{ lwgeom}\SpecialCharTok{::}\FunctionTok{st\_endpoint}\NormalTok{(minum\_dist\_to\_coast)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{g\_min\_dist\_line }\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ closest\_pt\_on\_coast,}
    \AttributeTok{color =} \StringTok{"blue"}\NormalTok{,}
    \AttributeTok{size =} \DecValTok{2}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{09-rep-africa-slave-trade_files/figure-latex/unnamed-chunk-13-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{countries\_simp}\SpecialCharTok{$}\NormalTok{nearest\_pt }\OtherTok{\textless{}{-}}\NormalTok{ closest\_pt\_on\_coast}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}
\NormalTok{  trade\_centers\_sf }\OtherTok{\textless{}{-}}
\NormalTok{    trade\_centers }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{st\_as\_sf}\NormalTok{(}\AttributeTok{coords =} \FunctionTok{c}\NormalTok{(}\StringTok{"lon"}\NormalTok{, }\StringTok{"lat"}\NormalTok{), }\AttributeTok{crs =} \DecValTok{4326}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{st\_transform}\NormalTok{(}\AttributeTok{crs =} \DecValTok{3857}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Simple feature collection with 9 features and 2 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -9168273 ymin: -2617513 xmax: -4288027 ymax: 4418219
## Projected CRS: WGS 84 / Pseudo-Mercator
## # A tibble: 9 x 3
##   name           fallingrain_name             geometry
## * <chr>          <chr>                     <POINT [m]>
## 1 Virginia       Virginia Beach     (-8458055 4418219)
## 2 Havana         Habana             (-9168273 2647748)
## 3 Haiti          Port au Prince     (-8051739 2100853)
## 4 Kingston       Kingston           (-8549337 2037549)
## 5 Dominica       Roseau             (-6835017 1723798)
## 6 Martinique     Fort-de-France     (-6799394 1644295)
## 7 Guyana         Georgetown        (-6473228 758755.9)
## 8 Salvador       Salvador da Bahia (-4288027 -1457447)
## 9 Rio de Janeiro Rio               (-4817908 -2617513)
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ trade\_centers\_sf, }\AttributeTok{color =} \StringTok{"red"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_sf}\NormalTok{(}\AttributeTok{data =}\NormalTok{ countries\_simp, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{geometry =}\NormalTok{ geometry)) }\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{09-rep-africa-slave-trade_files/figure-latex/unnamed-chunk-16-1.pdf}

\hypertarget{ux540eux8bb0}{%
\chapter{后记}\label{ux540eux8bb0}}

在写的过程中，逐渐感受到的一大趋势是：编程对于经济学来说是一项重要的方法，或者说，编程语言已经在当下逐渐变得越来越容易上手，使得不同行业的人群开始使用编程，来规范化行业内部的标准。目前随着chatgbt的盛行和快速发展，编程的门槛又进一步降低。

但另一方面，又存在一定的担忧，这些可能简单的编程工作若不上手，把手浸入脏水中，很难摸出大鱼。我的意思是，数据处理、文献复刻是一些非常简单的工作，但只是好高骛远的做，脑子里空转也无法得到一些有用的结论。

另一个较为深刻的感触是，数据难得，论文难写。

\printbibliography

\end{document}
